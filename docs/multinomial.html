<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Multinomial | Model Estimation by Example</title>
  <meta name="description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Multinomial | Model Estimation by Example" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/models-by-example/" />
  <meta property="og:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />
  <meta property="og:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="github-repo" content="m-clark/models-by-example/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Multinomial | Model Estimation by Example" />
  
  <meta name="twitter:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="twitter:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />



<meta name="date" content="2020-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon" />
<link rel="prev" href="naive-bayes.html"/>
<link rel="next" href="ordinal.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/book.css" type="text/css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="./">Model Estimation by Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>Models</b></span></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i>Standard Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#data-setup"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#obtain-model-estimates"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#comparison"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i>Standard Logistic</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#data-setup-1"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#obtain-model-estimates-1"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#comparison-1"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html"><i class="fa fa-check"></i>One-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#main-function"><i class="fa fa-check"></i>Main function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#data-set-up"><i class="fa fa-check"></i>Data set up</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#estimation"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#comparison-2"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#source-2"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html"><i class="fa fa-check"></i>Two-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#main-function-1"><i class="fa fa-check"></i>Main function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#data-set-up-1"><i class="fa fa-check"></i>Data set up</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#estimation-1"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#comparison-3"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#source-3"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html"><i class="fa fa-check"></i>Mixed Model via ML</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#maximum-likelihood-estimation"><i class="fa fa-check"></i>Maximum Likelihood Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#ml-function"><i class="fa fa-check"></i>ML function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#results"><i class="fa fa-check"></i>Results</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#issues-with-ml-estimation"><i class="fa fa-check"></i>Issues with ML estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#link-with-penalized-regression"><i class="fa fa-check"></i>Link with penalized regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#source-4"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html"><i class="fa fa-check"></i>Probit &amp; Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#standard-probit"><i class="fa fa-check"></i>standard probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#examples"><i class="fa fa-check"></i>Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#bivariate-probit"><i class="fa fa-check"></i>Bivariate probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#source-5"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html"><i class="fa fa-check"></i>Heckman Selection</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#data-setup-2"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-approach"><i class="fa fa-check"></i>2 step approach</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-1-probit-model"><i class="fa fa-check"></i>Step 1: Probit Model</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-2-estimate-via-linear-regression"><i class="fa fa-check"></i>Step 2: Estimate via linear regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#maximum-likelihood"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#comparison-4"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#source-6"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html"><i class="fa fa-check"></i>Tobit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-an-upper-limit"><i class="fa fa-check"></i>Demonstrate Censoring with an Upper Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#data-setup-3"><i class="fa fa-check"></i>Data setup</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-5"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-a-lower-limit"><i class="fa fa-check"></i>Demonstrate censoring with a Lower Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-6"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#source-7"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html"><i class="fa fa-check"></i>Naive Bayes</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#initialization"><i class="fa fa-check"></i>Initialization</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#comparison-7"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#source-8"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i>Multinomial</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#standard-categorical-model"><i class="fa fa-check"></i>Standard (categorical) model</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#import-data-and-setup"><i class="fa fa-check"></i>Import data and setup</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#multinomial-via-maximum-likelihood"><i class="fa fa-check"></i>Multinomial via Maximum Likelihood</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-8"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#alternative-specific-and-constant-variables"><i class="fa fa-check"></i>Alternative specific and constant variables</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-9"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#source-9"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i>Ordinal</a>
<ul>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#estimation-2"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#comparison-10"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#source-10"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Algorithms</b></span></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html"><i class="fa fa-check"></i>Penalized Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-4"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#functions-2"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#obtain-model-estimates-2"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-11"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-11"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i>L1 (lasso) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#functions-3"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#data-setup-5"><i class="fa fa-check"></i>Data setup</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#comparison-12"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#source-12"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i>L2 (ridge) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#comparison-13"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#source-13"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html"><i class="fa fa-check"></i>Newton and IRLS</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#glm-estimation-examples"><i class="fa fa-check"></i>GLM estimation examples</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#functions-4"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#newtons-method"><i class="fa fa-check"></i>Newton’s method</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#irls"><i class="fa fa-check"></i>IRLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#comparison-14"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#source-14"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html"><i class="fa fa-check"></i>Nelder Mead</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#first-version"><i class="fa fa-check"></i>First version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-1"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#second-version"><i class="fa fa-check"></i>Second version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-function"><i class="fa fa-check"></i>Example function</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model-1"><i class="fa fa-check"></i>A Regression Model</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#comparison-16"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#source-15"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html"><i class="fa fa-check"></i>Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#data-setup-7"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#gradient-descent-algorithm"><i class="fa fa-check"></i>Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#run"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#comparison-17"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#source-16"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html"><i class="fa fa-check"></i>Stochastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-8"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#stochastic-gradient-descent-algorithm"><i class="fa fa-check"></i>Stochastic Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-1"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-18"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-set-shift"><i class="fa fa-check"></i>Data Set Shift</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-2"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-19"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-1"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#source-17"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Other</b></span></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html"><i class="fa fa-check"></i>Supplemental</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#other-languages"><i class="fa fa-check"></i>Other Languages</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#algorithms"><i class="fa fa-check"></i>Algorithms</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li class='after'">
   <a href="https://m-clark.github.io/">
      <img src="img/mc_logo.png" style="width:25%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo">
   </a>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a href="https://github.com/m-clark/">
         <i class="fab fa-github fa-2x" aria-hidden="true"></i>
      </a>
   </div>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
         <i class="fab fa-creative-commons fa-lg"></i>
         <i class="fab fa-creative-commons-by fa-lg"></i>
         <i class="fab fa-creative-commons-sa fa-lg"></i>
      </a>
   </div>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model Estimation by Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multinomial" class="section level1">
<h1>Multinomial</h1>
<p>For more detail on these types of models, see my document at <a href="https://m-clark.github.io/docs/logregmodels.html" class="uri">https://m-clark.github.io/docs/logregmodels.html</a>.</p>
<div id="standard-categorical-model" class="section level2">
<h2>Standard (categorical) model</h2>
<div id="import-data-and-setup" class="section level3">
<h3>Import data and setup</h3>
<p>First, lets get some data.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="multinomial.html#cb120-1"></a><span class="kw">library</span>(haven)</span>
<span id="cb120-2"><a href="multinomial.html#cb120-2"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb120-3"><a href="multinomial.html#cb120-3"></a><span class="kw">library</span>(mlogit)</span>
<span id="cb120-4"><a href="multinomial.html#cb120-4"></a></span>
<span id="cb120-5"><a href="multinomial.html#cb120-5"></a>program =<span class="st"> </span><span class="kw">read_dta</span>(<span class="st">&quot;https://stats.idre.ucla.edu/stat/data/hsbdemo.dta&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb120-6"><a href="multinomial.html#cb120-6"></a><span class="st">  </span><span class="kw">as_factor</span>() <span class="op">%&gt;%</span></span>
<span id="cb120-7"><a href="multinomial.html#cb120-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prog =</span> <span class="kw">relevel</span>(prog, <span class="dt">ref =</span> <span class="st">&quot;academic&quot;</span>))</span>
<span id="cb120-8"><a href="multinomial.html#cb120-8"></a></span>
<span id="cb120-9"><a href="multinomial.html#cb120-9"></a><span class="kw">head</span>(program[, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>])</span></code></pre></div>
<pre><code># A tibble: 6 x 5
     id female ses    schtyp prog    
  &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;  &lt;fct&gt;   
1    45 female low    public vocation
2   108 male   middle public general 
3    15 male   high   public vocation
4    67 male   low    public vocation
5   153 male   middle public vocation
6    51 female high   public general </code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="multinomial.html#cb122-1"></a><span class="co"># convert to long form for mlogit</span></span>
<span id="cb122-2"><a href="multinomial.html#cb122-2"></a>programLong =<span class="st"> </span>program <span class="op">%&gt;%</span></span>
<span id="cb122-3"><a href="multinomial.html#cb122-3"></a><span class="st">  </span><span class="kw">select</span>(id, prog, ses, write) <span class="op">%&gt;%</span></span>
<span id="cb122-4"><a href="multinomial.html#cb122-4"></a><span class="st">  </span><span class="kw">mlogit.data</span>(</span>
<span id="cb122-5"><a href="multinomial.html#cb122-5"></a>    <span class="dt">data =</span> ,</span>
<span id="cb122-6"><a href="multinomial.html#cb122-6"></a>    <span class="dt">shape =</span> <span class="st">&#39;wide&#39;</span>,</span>
<span id="cb122-7"><a href="multinomial.html#cb122-7"></a>    <span class="dt">choice =</span> <span class="st">&#39;prog&#39;</span>,</span>
<span id="cb122-8"><a href="multinomial.html#cb122-8"></a>    <span class="dt">id.var =</span> <span class="st">&#39;id&#39;</span></span>
<span id="cb122-9"><a href="multinomial.html#cb122-9"></a>  )</span>
<span id="cb122-10"><a href="multinomial.html#cb122-10"></a></span>
<span id="cb122-11"><a href="multinomial.html#cb122-11"></a><span class="kw">head</span>(programLong)</span></code></pre></div>
<pre><code>~~~~~~~
 first 10 observations out of 600 
~~~~~~~
   id  prog    ses write chid      alt      idx
1   1 FALSE    low    44   11 academic  11:emic
2   1 FALSE    low    44   11  general  11:eral
3   1  TRUE    low    44   11 vocation  11:tion
4   2 FALSE middle    41    9 academic   9:emic
5   2 FALSE middle    41    9  general   9:eral
6   2  TRUE middle    41    9 vocation   9:tion
7   3  TRUE    low    65  159 academic 159:emic
8   3 FALSE    low    65  159  general 159:eral
9   3 FALSE    low    65  159 vocation 159:tion
10  4  TRUE    low    50   30 academic  30:emic

~~~ indexes ~~~~
   chid id      alt
1    11  1 academic
2    11  1  general
3    11  1 vocation
4     9  2 academic
5     9  2  general
6     9  2 vocation
7   159  3 academic
8   159  3  general
9   159  3 vocation
10   30  4 academic
indexes:  1, 1, 2 </code></pre>
<p>We go ahead and run a model via mlogit for later comparison.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="multinomial.html#cb124-1"></a>mlogit_mod   =<span class="st"> </span><span class="kw">mlogit</span>(prog <span class="op">~</span><span class="st"> </span><span class="dv">1</span><span class="op">|</span><span class="st"> </span>write <span class="op">+</span><span class="st"> </span>ses, <span class="dt">data =</span> programLong)</span>
<span id="cb124-2"><a href="multinomial.html#cb124-2"></a>mlogit_coefs =<span class="st"> </span><span class="kw">coef</span>(mlogit_mod)[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">4</span>)]  <span class="co"># reorder</span></span></code></pre></div>
</div>
<div id="multinomial-via-maximum-likelihood" class="section level3">
<h3>Multinomial via Maximum Likelihood</h3>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="multinomial.html#cb125-1"></a>multinomregML &lt;-<span class="st"> </span><span class="cf">function</span>(par, X, y) {</span>
<span id="cb125-2"><a href="multinomial.html#cb125-2"></a>  levs =<span class="st"> </span><span class="kw">levels</span>(y)</span>
<span id="cb125-3"><a href="multinomial.html#cb125-3"></a>  ref  =<span class="st"> </span>levs[<span class="dv">1</span>]              <span class="co"># reference level (category label 1)</span></span>
<span id="cb125-4"><a href="multinomial.html#cb125-4"></a>  </span>
<span id="cb125-5"><a href="multinomial.html#cb125-5"></a>  y0 =<span class="st"> </span>y <span class="op">==</span><span class="st"> </span>ref</span>
<span id="cb125-6"><a href="multinomial.html#cb125-6"></a>  y1 =<span class="st"> </span>y <span class="op">==</span><span class="st"> </span>levs[<span class="dv">2</span>]             <span class="co"># category 2</span></span>
<span id="cb125-7"><a href="multinomial.html#cb125-7"></a>  y2 =<span class="st"> </span>y <span class="op">==</span><span class="st"> </span>levs[<span class="dv">3</span>]             <span class="co"># category 3</span></span>
<span id="cb125-8"><a href="multinomial.html#cb125-8"></a>  </span>
<span id="cb125-9"><a href="multinomial.html#cb125-9"></a>  beta =<span class="st"> </span><span class="kw">matrix</span>(par, <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb125-10"><a href="multinomial.html#cb125-10"></a>  </span>
<span id="cb125-11"><a href="multinomial.html#cb125-11"></a>  <span class="co"># more like mnlogit package depiction in its function</span></span>
<span id="cb125-12"><a href="multinomial.html#cb125-12"></a>  <span class="co"># V1 = X %*% beta[ ,1]</span></span>
<span id="cb125-13"><a href="multinomial.html#cb125-13"></a>  <span class="co"># V2 = X %*% beta[ ,2]</span></span>
<span id="cb125-14"><a href="multinomial.html#cb125-14"></a>  <span class="co"># ll = sum(-log(1 + exp(V1) + exp(V2))) + sum(V1[y1], V2[y2])</span></span>
<span id="cb125-15"><a href="multinomial.html#cb125-15"></a>  </span>
<span id="cb125-16"><a href="multinomial.html#cb125-16"></a>  V =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>beta                           <span class="co"># a vectorized approach</span></span>
<span id="cb125-17"><a href="multinomial.html#cb125-17"></a>  baseProbVec =<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">exp</span>(V)))  <span class="co"># reference group probabilities</span></span>
<span id="cb125-18"><a href="multinomial.html#cb125-18"></a>  </span>
<span id="cb125-19"><a href="multinomial.html#cb125-19"></a>  loglik =<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(baseProbVec))  <span class="op">+</span><span class="st"> </span><span class="kw">crossprod</span>(<span class="kw">c</span>(V), <span class="kw">c</span>(y1, y2))</span>
<span id="cb125-20"><a href="multinomial.html#cb125-20"></a>  </span>
<span id="cb125-21"><a href="multinomial.html#cb125-21"></a>  loglik</span>
<span id="cb125-22"><a href="multinomial.html#cb125-22"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="multinomial.html#cb126-1"></a>out =<span class="st"> </span><span class="kw">optim</span>(</span>
<span id="cb126-2"><a href="multinomial.html#cb126-2"></a>  <span class="kw">runif</span>(<span class="dv">8</span>,<span class="op">-</span>.<span class="dv">1</span>, <span class="fl">.1</span>),</span>
<span id="cb126-3"><a href="multinomial.html#cb126-3"></a>  multinomregML,</span>
<span id="cb126-4"><a href="multinomial.html#cb126-4"></a>  <span class="dt">X =</span> <span class="kw">model.matrix</span>(prog <span class="op">~</span><span class="st"> </span>ses <span class="op">+</span><span class="st"> </span>write, <span class="dt">data =</span> program),</span>
<span id="cb126-5"><a href="multinomial.html#cb126-5"></a>  <span class="dt">y =</span> program<span class="op">$</span>prog,</span>
<span id="cb126-6"><a href="multinomial.html#cb126-6"></a>  <span class="dt">control =</span> <span class="kw">list</span>(</span>
<span id="cb126-7"><a href="multinomial.html#cb126-7"></a>    <span class="dt">maxit   =</span> <span class="dv">1000</span>,</span>
<span id="cb126-8"><a href="multinomial.html#cb126-8"></a>    <span class="dt">reltol  =</span> <span class="fl">1e-12</span>,</span>
<span id="cb126-9"><a href="multinomial.html#cb126-9"></a>    <span class="dt">ndeps   =</span> <span class="kw">rep</span>(<span class="fl">1e-8</span>, <span class="dv">8</span>),</span>
<span id="cb126-10"><a href="multinomial.html#cb126-10"></a>    <span class="dt">trace   =</span> <span class="ot">TRUE</span>,</span>
<span id="cb126-11"><a href="multinomial.html#cb126-11"></a>    <span class="dt">fnscale =</span> <span class="dv">-1</span>,</span>
<span id="cb126-12"><a href="multinomial.html#cb126-12"></a>    <span class="dt">type    =</span> <span class="dv">3</span></span>
<span id="cb126-13"><a href="multinomial.html#cb126-13"></a>  ),</span>
<span id="cb126-14"><a href="multinomial.html#cb126-14"></a>  <span class="dt">method =</span> <span class="st">&#39;BFGS&#39;</span></span>
<span id="cb126-15"><a href="multinomial.html#cb126-15"></a>)</span></code></pre></div>
<pre><code>initial  value 638.963532 
iter  10 value 180.008322
final  value 179.981726 
converged</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="multinomial.html#cb128-1"></a><span class="co"># out$par</span></span></code></pre></div>
</div>
<div id="comparison-8" class="section level3">
<h3>Comparison</h3>
<p>An initial comparison.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="multinomial.html#cb129-1"></a><span class="kw">cbind</span>(out<span class="op">$</span>par, mlogit_coefs) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb129-2"><a href="multinomial.html#cb129-2"></a><span class="st">  </span><span class="kw">round</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>                             mlogit_coefs
(Intercept):general   2.8522       2.8522
sesmiddle:general    -0.5333      -0.5333
seshigh:general      -1.1628      -1.1628
write:general        -0.0579      -0.0579
(Intercept):vocation  5.2182       5.2182
sesmiddle:vocation    0.2914       0.2914
seshigh:vocation     -0.9827      -0.9827
write:vocation       -0.1136      -0.1136</code></pre>
<p>The following use <span class="func" style="">dmultinom</span> for the likelihood, similar to other modeling demonstrations in this document.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="multinomial.html#cb131-1"></a>X =<span class="st"> </span><span class="kw">model.matrix</span>(prog <span class="op">~</span><span class="st"> </span>ses <span class="op">+</span><span class="st"> </span>write, <span class="dt">data =</span> program)</span>
<span id="cb131-2"><a href="multinomial.html#cb131-2"></a>y =<span class="st"> </span>program<span class="op">$</span>prog</span>
<span id="cb131-3"><a href="multinomial.html#cb131-3"></a>pars =<span class="st"> </span><span class="kw">matrix</span>(out<span class="op">$</span>par, <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb131-4"><a href="multinomial.html#cb131-4"></a>V =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>pars</span>
<span id="cb131-5"><a href="multinomial.html#cb131-5"></a>acadprob   =<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span><span class="op">+</span><span class="kw">rowSums</span>(<span class="kw">exp</span>(V)))</span>
<span id="cb131-6"><a href="multinomial.html#cb131-6"></a>fitnonacad =<span class="st"> </span><span class="kw">exp</span>(V) <span class="op">*</span><span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rep</span>(acadprob, <span class="dv">2</span>), <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb131-7"><a href="multinomial.html#cb131-7"></a>fits =<span class="st"> </span><span class="kw">cbind</span>(acadprob, fitnonacad)</span>
<span id="cb131-8"><a href="multinomial.html#cb131-8"></a>yind =<span class="st"> </span><span class="kw">model.matrix</span>( <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>prog, <span class="dt">data =</span> program)</span></code></pre></div>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="multinomial.html#cb132-1"></a><span class="co"># because dmultinom can&#39;t take matrix for prob</span></span>
<span id="cb132-2"><a href="multinomial.html#cb132-2"></a>ll =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb132-3"><a href="multinomial.html#cb132-3"></a></span>
<span id="cb132-4"><a href="multinomial.html#cb132-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">200</span>){</span>
<span id="cb132-5"><a href="multinomial.html#cb132-5"></a>  ll =<span class="st"> </span>ll <span class="op">+</span><span class="st"> </span><span class="kw">dmultinom</span>(yind[i, ],</span>
<span id="cb132-6"><a href="multinomial.html#cb132-6"></a>                      <span class="dt">size =</span> <span class="dv">1</span>,</span>
<span id="cb132-7"><a href="multinomial.html#cb132-7"></a>                      <span class="dt">prob =</span> fits[i, ],</span>
<span id="cb132-8"><a href="multinomial.html#cb132-8"></a>                      <span class="dt">log  =</span> <span class="ot">TRUE</span>)</span>
<span id="cb132-9"><a href="multinomial.html#cb132-9"></a>}</span>
<span id="cb132-10"><a href="multinomial.html#cb132-10"></a></span>
<span id="cb132-11"><a href="multinomial.html#cb132-11"></a>ll</span></code></pre></div>
<pre><code>[1] -179.9817</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="multinomial.html#cb134-1"></a>out<span class="op">$</span>value</span></code></pre></div>
<pre><code>[1] -179.9817</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="multinomial.html#cb136-1"></a><span class="kw">logLik</span>(mlogit_mod)</span></code></pre></div>
<pre><code>&#39;log Lik.&#39; -179.9817 (df=8)</code></pre>
</div>
</div>
<div id="alternative-specific-and-constant-variables" class="section level2">
<h2>Alternative specific and constant variables</h2>
<p>Now we add <em>alternative specific</em> and <em>alternative constant</em> variables to the previous <em>individual specific</em> covariates.. In this example, <code>price</code> is alternative invariant (<code>Z</code>) <code>income</code> is individual/alternative specific (<code>X</code>), and <code>catch</code> is alternative specific (<code>Y</code>).</p>
<p>We can use the <code>fish</code> data from the <span class="pack" style="">mnlogit</span> package.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="multinomial.html#cb138-1"></a><span class="kw">library</span>(mnlogit)</span>
<span id="cb138-2"><a href="multinomial.html#cb138-2"></a><span class="kw">data</span>(Fish)</span>
<span id="cb138-3"><a href="multinomial.html#cb138-3"></a></span>
<span id="cb138-4"><a href="multinomial.html#cb138-4"></a><span class="kw">head</span>(Fish)</span></code></pre></div>
<pre><code>           mode   income     alt   price  catch chid
1.beach   FALSE 7083.332   beach 157.930 0.0678    1
1.boat    FALSE 7083.332    boat 157.930 0.2601    1
1.charter  TRUE 7083.332 charter 182.930 0.5391    1
1.pier    FALSE 7083.332    pier 157.930 0.0503    1
2.beach   FALSE 1250.000   beach  15.114 0.1049    2
2.boat    FALSE 1250.000    boat  10.534 0.1574    2</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="multinomial.html#cb140-1"></a>fm  =<span class="st"> </span><span class="kw">formula</span>(mode <span class="op">~</span><span class="st"> </span>price <span class="op">|</span><span class="st"> </span>income <span class="op">|</span><span class="st"> </span>catch)</span>
<span id="cb140-2"><a href="multinomial.html#cb140-2"></a></span>
<span id="cb140-3"><a href="multinomial.html#cb140-3"></a>fit =<span class="st"> </span><span class="kw">mnlogit</span>(fm, Fish)</span>
<span id="cb140-4"><a href="multinomial.html#cb140-4"></a><span class="co"># fit = mlogit(fm, Fish)</span></span>
<span id="cb140-5"><a href="multinomial.html#cb140-5"></a><span class="kw">summary</span>(fit)</span></code></pre></div>
<pre><code>
Call:
mnlogit(formula = fm, data = Fish)

Frequencies of alternatives in input data:
  beach    boat charter    pier 
0.11337 0.35364 0.38240 0.15059 

Number of observations in data = 1182
Number of alternatives = 4
Intercept turned: ON
Number of parameters in model = 11
  # individual specific variables = 2
  # choice specific coeff variables = 1
  # individual independent variables = 1

-------------------------------------------------------------
Maximum likelihood estimation using the Newton-Raphson method
-------------------------------------------------------------
  Number of iterations: 7
  Number of linesearch iterations: 10
At termination: 
  Gradient norm = 2.09e-06
  Diff between last 2 loglik values = 0
  Stopping reason: Succesive loglik difference &lt; ftol (1e-06).
Total estimation time (sec): 0.017
Time for Hessian calculations (sec): 0.002 using 1 processors.

Coefficients : 
                       Estimate   Std.Error  t-value  Pr(&gt;|t|)    
(Intercept):boat     8.4184e-01  2.9996e-01   2.8065 0.0050080 ** 
(Intercept):charter  2.1549e+00  2.9746e-01   7.2443 4.348e-13 ***
(Intercept):pier     1.0430e+00  2.9535e-01   3.5315 0.0004132 ***
income:boat          5.5428e-05  5.2130e-05   1.0633 0.2876611    
income:charter      -7.2337e-05  5.2557e-05  -1.3764 0.1687088    
income:pier         -1.3550e-04  5.1172e-05  -2.6480 0.0080977 ** 
catch:beach          3.1177e+00  7.1305e-01   4.3724 1.229e-05 ***
catch:boat           2.5425e+00  5.2274e-01   4.8638 1.152e-06 ***
catch:charter        7.5949e-01  1.5420e-01   4.9254 8.417e-07 ***
catch:pier           2.8512e+00  7.7464e-01   3.6807 0.0002326 ***
price               -2.5281e-02  1.7551e-03 -14.4046 &lt; 2.2e-16 ***
---
Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1

Log-Likelihood: -1199.1, df = 11
AIC:  2420.3 </code></pre>
<p>The likelihood function.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="multinomial.html#cb142-1"></a>multinomregML2 &lt;-<span class="st"> </span><span class="cf">function</span>(par, X, Y, Z, respVec, choice) {</span>
<span id="cb142-2"><a href="multinomial.html#cb142-2"></a></span>
<span id="cb142-3"><a href="multinomial.html#cb142-3"></a>  <span class="co"># X dim nrow(Fish)/K x p + 1 (intercept)</span></span>
<span id="cb142-4"><a href="multinomial.html#cb142-4"></a>  <span class="co"># Z, Y nrow(N); Y has alt specific coefs; then for Z ref group dropped so nrow = nrow*(K-1)/K</span></span>
<span id="cb142-5"><a href="multinomial.html#cb142-5"></a>  <span class="co"># for ll everything through previous X the same</span></span>
<span id="cb142-6"><a href="multinomial.html#cb142-6"></a>  <span class="co"># then calc probmat for Y and Z, add to X probmat, and add to base</span></span>
<span id="cb142-7"><a href="multinomial.html#cb142-7"></a>  </span>
<span id="cb142-8"><a href="multinomial.html#cb142-8"></a>  N =<span class="st"> </span><span class="kw">sum</span>(choice)</span>
<span id="cb142-9"><a href="multinomial.html#cb142-9"></a>  K =<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(respVec))</span>
<span id="cb142-10"><a href="multinomial.html#cb142-10"></a>  levs =<span class="st"> </span><span class="kw">levels</span>(respVec)</span>
<span id="cb142-11"><a href="multinomial.html#cb142-11"></a>  </span>
<span id="cb142-12"><a href="multinomial.html#cb142-12"></a>  xpar =<span class="st"> </span><span class="kw">matrix</span>(par[<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>], <span class="dt">ncol =</span> K<span class="dv">-1</span>)</span>
<span id="cb142-13"><a href="multinomial.html#cb142-13"></a>  ypar =<span class="st"> </span><span class="kw">matrix</span>(par[<span class="dv">7</span><span class="op">:</span><span class="dv">10</span>], <span class="dt">ncol =</span> K)</span>
<span id="cb142-14"><a href="multinomial.html#cb142-14"></a>  zpar =<span class="st"> </span><span class="kw">matrix</span>(par[<span class="kw">length</span>(par)], <span class="dt">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb142-15"><a href="multinomial.html#cb142-15"></a>  </span>
<span id="cb142-16"><a href="multinomial.html#cb142-16"></a>  <span class="co"># Calc X</span></span>
<span id="cb142-17"><a href="multinomial.html#cb142-17"></a>  Vx  =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>xpar</span>
<span id="cb142-18"><a href="multinomial.html#cb142-18"></a>  </span>
<span id="cb142-19"><a href="multinomial.html#cb142-19"></a>  <span class="co"># Calc Y (mnlogit finds N x 1 results by going through 1:N, N+1:N*2 etc; then</span></span>
<span id="cb142-20"><a href="multinomial.html#cb142-20"></a>  <span class="co"># makes 1 vector, then subtracts the first 1:N from whole vector, then makes</span></span>
<span id="cb142-21"><a href="multinomial.html#cb142-21"></a>  <span class="co"># Nxk-1 matrix with N+1:end values (as 1:N are just zero)); creating the</span></span>
<span id="cb142-22"><a href="multinomial.html#cb142-22"></a>  <span class="co"># vector and rebuilding the matrix is unnecessary though</span></span>
<span id="cb142-23"><a href="multinomial.html#cb142-23"></a>  Vy =<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span>K, <span class="cf">function</span>(alt) </span>
<span id="cb142-24"><a href="multinomial.html#cb142-24"></a>    Y[respVec <span class="op">==</span><span class="st"> </span>levs[alt], , <span class="dt">drop =</span> <span class="ot">FALSE</span>] <span class="op">%*%</span><span class="st"> </span>ypar[alt])</span>
<span id="cb142-25"><a href="multinomial.html#cb142-25"></a>  </span>
<span id="cb142-26"><a href="multinomial.html#cb142-26"></a>  Vy =<span class="st"> </span>Vy[,<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>Vy[,<span class="dv">1</span>]</span>
<span id="cb142-27"><a href="multinomial.html#cb142-27"></a>  </span>
<span id="cb142-28"><a href="multinomial.html#cb142-28"></a>  <span class="co"># Calc Z</span></span>
<span id="cb142-29"><a href="multinomial.html#cb142-29"></a>  Vz =<span class="st"> </span>Z <span class="op">%*%</span><span class="st"> </span>zpar</span>
<span id="cb142-30"><a href="multinomial.html#cb142-30"></a>  Vz =<span class="st"> </span><span class="kw">matrix</span>(Vz, <span class="dt">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb142-31"><a href="multinomial.html#cb142-31"></a>  </span>
<span id="cb142-32"><a href="multinomial.html#cb142-32"></a>  <span class="co"># all Vs must fit into N x K -1 matrix where N is nobs (i.e. individuals)</span></span>
<span id="cb142-33"><a href="multinomial.html#cb142-33"></a>  V =<span class="st"> </span>Vx <span class="op">+</span><span class="st"> </span>Vy <span class="op">+</span><span class="st"> </span>Vz</span>
<span id="cb142-34"><a href="multinomial.html#cb142-34"></a>  </span>
<span id="cb142-35"><a href="multinomial.html#cb142-35"></a>  ll0 =<span class="st"> </span><span class="kw">crossprod</span>(<span class="kw">c</span>(V), choice[<span class="op">-</span>(<span class="dv">1</span><span class="op">:</span>N)])</span>
<span id="cb142-36"><a href="multinomial.html#cb142-36"></a>  baseProbVec &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">exp</span>(V)))</span>
<span id="cb142-37"><a href="multinomial.html#cb142-37"></a>  loglik =<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(baseProbVec)) <span class="op">+</span><span class="st"> </span>ll0</span>
<span id="cb142-38"><a href="multinomial.html#cb142-38"></a>  </span>
<span id="cb142-39"><a href="multinomial.html#cb142-39"></a>  loglik</span>
<span id="cb142-40"><a href="multinomial.html#cb142-40"></a>  </span>
<span id="cb142-41"><a href="multinomial.html#cb142-41"></a>  <span class="co"># note fitted values via</span></span>
<span id="cb142-42"><a href="multinomial.html#cb142-42"></a>  <span class="co"># fitnonref = exp(V) * matrix(rep(baseProbVec, K-1), ncol = K-1)</span></span>
<span id="cb142-43"><a href="multinomial.html#cb142-43"></a>  <span class="co"># fitref = 1-rowSums(fitnonref)</span></span>
<span id="cb142-44"><a href="multinomial.html#cb142-44"></a>  <span class="co"># fits = cbind(fitref, fitnonref)</span></span>
<span id="cb142-45"><a href="multinomial.html#cb142-45"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="multinomial.html#cb143-1"></a>inits =<span class="st"> </span><span class="kw">runif</span>(<span class="dv">11</span>, <span class="fl">-.1</span>, <span class="fl">.1</span>)</span>
<span id="cb143-2"><a href="multinomial.html#cb143-2"></a>mdat  =<span class="st"> </span><span class="kw">mnlogit</span>(fm, Fish)<span class="op">$</span>model  <span class="co"># this data already ordered!</span></span></code></pre></div>
<p>As <code>X</code> has a constant value across alternatives, the coefficients regard the selection of the alternative relative to reference.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="multinomial.html#cb144-1"></a>X =<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span>, mdat[mdat<span class="op">$</span><span class="st">`</span><span class="dt">_Alt_Indx_</span><span class="st">`</span> <span class="op">==</span><span class="st"> &#39;beach&#39;</span>, <span class="st">&#39;income&#39;</span>])</span>
<span id="cb144-2"><a href="multinomial.html#cb144-2"></a><span class="kw">dim</span>(X)</span></code></pre></div>
<pre><code>[1] 1182    2</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="multinomial.html#cb146-1"></a><span class="kw">head</span>(X)</span></code></pre></div>
<pre><code>     [,1]     [,2]
[1,]    1 7083.332
[2,]    1 1250.000
[3,]    1 3750.000
[4,]    1 2083.333
[5,]    1 4583.332
[6,]    1 4583.332</code></pre>
<p><code>Y</code> will use the complete data to start. Coefficients will be differences from the reference alternative coefficient.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="multinomial.html#cb148-1"></a>Y =<span class="st"> </span><span class="kw">as.matrix</span>(mdat[, <span class="st">&#39;catch&#39;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb148-2"><a href="multinomial.html#cb148-2"></a><span class="kw">dim</span>(Y)</span></code></pre></div>
<pre><code>[1] 4728    1</code></pre>
<p><code>Z</code> are difference scores from reference group.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="multinomial.html#cb150-1"></a>Z =<span class="st"> </span><span class="kw">as.matrix</span>(mdat[mdat<span class="op">$</span><span class="st">`</span><span class="dt">_Alt_Indx_</span><span class="st">`</span> <span class="op">!=</span><span class="st"> &#39;beach&#39;</span>, <span class="st">&#39;price&#39;</span>, <span class="dt">drop =</span> <span class="ot">FALSE</span>])</span>
<span id="cb150-2"><a href="multinomial.html#cb150-2"></a>Z =<span class="st"> </span>Z <span class="op">-</span><span class="st"> </span>mdat[mdat<span class="op">$</span><span class="st">`</span><span class="dt">_Alt_Indx_</span><span class="st">`</span> <span class="op">==</span><span class="st"> &#39;beach&#39;</span>, <span class="st">&#39;price&#39;</span>]</span>
<span id="cb150-3"><a href="multinomial.html#cb150-3"></a><span class="kw">dim</span>(Z)</span></code></pre></div>
<pre><code>[1] 3546    1</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="multinomial.html#cb152-1"></a>respVec =<span class="st"> </span>mdat<span class="op">$</span><span class="st">`</span><span class="dt">_Alt_Indx_</span><span class="st">`</span> <span class="co"># first 10 should be 0 0 1 0 1 0 0 0 1 1 after beach dropped</span></span></code></pre></div>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="multinomial.html#cb153-1"></a><span class="kw">multinomregML2</span>(inits, X, Y, Z, respVec, <span class="dt">choice =</span> mdat<span class="op">$</span>mode)</span></code></pre></div>
<pre><code>          [,1]
[1,] -162384.5</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="multinomial.html#cb155-1"></a>out =<span class="st"> </span><span class="kw">optim</span>(</span>
<span id="cb155-2"><a href="multinomial.html#cb155-2"></a>  <span class="dt">par =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">11</span>),</span>
<span id="cb155-3"><a href="multinomial.html#cb155-3"></a>  multinomregML2,</span>
<span id="cb155-4"><a href="multinomial.html#cb155-4"></a>  <span class="dt">X =</span> X,</span>
<span id="cb155-5"><a href="multinomial.html#cb155-5"></a>  <span class="dt">Y =</span> Y,</span>
<span id="cb155-6"><a href="multinomial.html#cb155-6"></a>  <span class="dt">Z =</span> Z,</span>
<span id="cb155-7"><a href="multinomial.html#cb155-7"></a>  <span class="dt">respVec =</span> respVec,</span>
<span id="cb155-8"><a href="multinomial.html#cb155-8"></a>  <span class="dt">choice  =</span> mdat<span class="op">$</span>mode,</span>
<span id="cb155-9"><a href="multinomial.html#cb155-9"></a>  <span class="dt">control =</span> <span class="kw">list</span>(</span>
<span id="cb155-10"><a href="multinomial.html#cb155-10"></a>    <span class="dt">maxit   =</span> <span class="dv">1000</span>,</span>
<span id="cb155-11"><a href="multinomial.html#cb155-11"></a>    <span class="dt">reltol  =</span> <span class="fl">1e-12</span>,</span>
<span id="cb155-12"><a href="multinomial.html#cb155-12"></a>    <span class="dt">ndeps   =</span> <span class="kw">rep</span>(<span class="fl">1e-8</span>, <span class="dv">11</span>),</span>
<span id="cb155-13"><a href="multinomial.html#cb155-13"></a>    <span class="dt">trace   =</span> <span class="ot">TRUE</span>,</span>
<span id="cb155-14"><a href="multinomial.html#cb155-14"></a>    <span class="dt">fnscale =</span> <span class="dv">-1</span>,</span>
<span id="cb155-15"><a href="multinomial.html#cb155-15"></a>    <span class="dt">type    =</span> <span class="dv">3</span></span>
<span id="cb155-16"><a href="multinomial.html#cb155-16"></a>  ),</span>
<span id="cb155-17"><a href="multinomial.html#cb155-17"></a>  <span class="dt">method =</span> <span class="st">&#39;BFGS&#39;</span></span>
<span id="cb155-18"><a href="multinomial.html#cb155-18"></a>)</span></code></pre></div>
<pre><code>initial  value 1638.599935 
iter  10 value 1253.603448
iter  20 value 1199.143447
final  value 1199.143445 
converged</code></pre>
<div id="comparison-9" class="section level3">
<h3>Comparison</h3>
<p>Compare fits.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="multinomial.html#cb157-1"></a><span class="co"># out</span></span>
<span id="cb157-2"><a href="multinomial.html#cb157-2"></a></span>
<span id="cb157-3"><a href="multinomial.html#cb157-3"></a><span class="co"># round(out$par, 3)</span></span>
<span id="cb157-4"><a href="multinomial.html#cb157-4"></a></span>
<span id="cb157-5"><a href="multinomial.html#cb157-5"></a><span class="kw">round</span>(<span class="kw">cbind</span>(out<span class="op">$</span>par, <span class="kw">coef</span>(fit)), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>                      [,1]   [,2]
(Intercept):boat     0.842  0.842
income:boat          0.000  0.000
(Intercept):charter  2.155  2.155
income:charter       0.000  0.000
(Intercept):pier     1.043  1.043
income:pier          0.000  0.000
catch:beach          3.118  3.118
catch:boat           2.542  2.542
catch:charter        0.759  0.759
catch:pier           2.851  2.851
price               -0.025 -0.025</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="multinomial.html#cb159-1"></a><span class="kw">cbind</span>(<span class="kw">logLik</span>(fit), out<span class="op">$</span>value)</span></code></pre></div>
<pre><code>          [,1]      [,2]
[1,] -1199.143 -1199.143</code></pre>
</div>
</div>
<div id="source-9" class="section level2">
<h2>Source</h2>
<p>Base R source code found at <a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/multinomial.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/multinomial.R</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="naive-bayes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ordinal.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "facebook", "linkedin", "google", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/m-clark/models-by-example/blob/master/multinomial.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"df_print": "kable",
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
