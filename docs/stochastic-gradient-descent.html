<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Stochastic Gradient Descent | Model Estimation by Example</title>
  <meta name="description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Stochastic Gradient Descent | Model Estimation by Example" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/models-by-example/" />
  <meta property="og:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />
  <meta property="og:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="github-repo" content="m-clark/models-by-example/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Stochastic Gradient Descent | Model Estimation by Example" />
  
  <meta name="twitter:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="twitter:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />



<meta name="date" content="2020-11-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon" />
<link rel="prev" href="gradient-descent.html"/>
<link rel="next" href="supplemental.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/book.css" type="text/css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="./">Model Estimation by Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>Models</b></span></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i>Standard Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#data-setup"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#obtain-model-estimates"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#comparison"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i>Standard Logistic</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#data-setup-1"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#obtain-model-estimates-1"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#comparison-1"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html"><i class="fa fa-check"></i>One-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#main-function"><i class="fa fa-check"></i>Main function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#data-set-up"><i class="fa fa-check"></i>Data set up</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#estimation"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#comparison-2"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#source-2"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html"><i class="fa fa-check"></i>Two-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#main-function-1"><i class="fa fa-check"></i>Main function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#data-set-up-1"><i class="fa fa-check"></i>Data set up</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#estimation-1"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#comparison-3"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#source-3"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html"><i class="fa fa-check"></i>Mixed Model via ML</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#maximum-likelihood-estimation"><i class="fa fa-check"></i>Maximum Likelihood Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#ml-function"><i class="fa fa-check"></i>ML function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#results"><i class="fa fa-check"></i>Results</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#issues-with-ml-estimation"><i class="fa fa-check"></i>Issues with ML estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#link-with-penalized-regression"><i class="fa fa-check"></i>Link with penalized regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#source-4"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html"><i class="fa fa-check"></i>Probit &amp; Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#standard-probit"><i class="fa fa-check"></i>standard probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#examples"><i class="fa fa-check"></i>Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#bivariate-probit"><i class="fa fa-check"></i>Bivariate probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#source-5"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html"><i class="fa fa-check"></i>Heckman Selection</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#data-setup-2"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-approach"><i class="fa fa-check"></i>2 step approach</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-1-probit-model"><i class="fa fa-check"></i>Step 1: Probit Model</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-2-estimate-via-linear-regression"><i class="fa fa-check"></i>Step 2: Estimate via linear regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#maximum-likelihood"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#comparison-4"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#source-6"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html"><i class="fa fa-check"></i>Tobit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-an-upper-limit"><i class="fa fa-check"></i>Demonstrate Censoring with an Upper Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#data-setup-3"><i class="fa fa-check"></i>Data setup</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-5"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-a-lower-limit"><i class="fa fa-check"></i>Demonstrate censoring with a Lower Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-6"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#source-7"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html"><i class="fa fa-check"></i>Naive Bayes</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#initialization"><i class="fa fa-check"></i>Initialization</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#comparison-7"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#source-8"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i>Multinomial</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#standard-categorical-model"><i class="fa fa-check"></i>Standard (categorical) model</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#import-data-and-setup"><i class="fa fa-check"></i>Import data and setup</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#multinomial-via-maximum-likelihood"><i class="fa fa-check"></i>Multinomial via Maximum Likelihood</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-8"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#alternative-specific-and-constant-variables"><i class="fa fa-check"></i>Alternative specific and constant variables</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-9"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#source-9"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i>Ordinal</a>
<ul>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#estimation-2"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#comparison-10"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#source-10"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Algorithms</b></span></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html"><i class="fa fa-check"></i>Penalized Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-4"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#functions-2"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#obtain-model-estimates-2"><i class="fa fa-check"></i>Obtain Model Estimates</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-11"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-11"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i>L1 (lasso) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#functions-3"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#data-setup-5"><i class="fa fa-check"></i>Data setup</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#comparison-12"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#source-12"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i>L2 (ridge) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#comparison-13"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#source-13"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html"><i class="fa fa-check"></i>Newton and IRLS</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#glm-estimation-examples"><i class="fa fa-check"></i>GLM estimation examples</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#functions-4"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#newtons-method"><i class="fa fa-check"></i>Newton’s method</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#irls"><i class="fa fa-check"></i>IRLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#comparison-14"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#source-14"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html"><i class="fa fa-check"></i>Nelder Mead</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#first-version"><i class="fa fa-check"></i>First version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-1"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#second-version"><i class="fa fa-check"></i>Second version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-function"><i class="fa fa-check"></i>Example function</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model-1"><i class="fa fa-check"></i>A Regression Model</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#comparison-16"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#source-15"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html"><i class="fa fa-check"></i>Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#data-setup-7"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#gradient-descent-algorithm"><i class="fa fa-check"></i>Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#run"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#comparison-17"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#source-16"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html"><i class="fa fa-check"></i>Stochastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-8"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#stochastic-gradient-descent-algorithm"><i class="fa fa-check"></i>Stochastic Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-1"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-18"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-set-shift"><i class="fa fa-check"></i>Data Set Shift</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-2"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-19"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-1"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#source-17"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Other</b></span></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html"><i class="fa fa-check"></i>Supplemental</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#other-languages"><i class="fa fa-check"></i>Other Languages</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#algorithms"><i class="fa fa-check"></i>Algorithms</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li class='after'">
   <a href="https://m-clark.github.io/">
      <img src="img/mc_logo.png" style="width:25%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo">
   </a>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a href="https://github.com/m-clark/">
         <i class="fab fa-github fa-2x" aria-hidden="true"></i>
      </a>
   </div>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
         <i class="fab fa-creative-commons fa-lg"></i>
         <i class="fab fa-creative-commons-by fa-lg"></i>
         <i class="fab fa-creative-commons-sa fa-lg"></i>
      </a>
   </div>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model Estimation by Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stochastic-gradient-descent" class="section level1">
<h1>Stochastic Gradient Descent</h1>
<p>Here we have ‘online’ learning via stochastic gradient descent. See also, <a href="gradient-descent.html#gradient-descent">standard
gradient descent</a> In the following, we have basic data
for standard regression, but in this ‘online’ learning case, we can assume
each observation comes to us as a stream over time rather than as a single
batch, and would continue coming in. Note that there are plenty of variations
of this, and it can be applied in the batch case as well. Currently no
stopping point is implemented in order to trace results over all data
points/iterations.</p>
<p>On revisiting this much later, I thought it useful to add that I believe this
was motivated by the example in Murphy’s Probabilistic Machine Learning. I
also made some cleanup to my original code, added some comments, but mostly
left it as it was.</p>
<div id="data-setup-8" class="section level2">
<h2>Data Setup</h2>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="stochastic-gradient-descent.html#cb247-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb247-2"><a href="stochastic-gradient-descent.html#cb247-2"></a></span>
<span id="cb247-3"><a href="stochastic-gradient-descent.html#cb247-3"></a>n  =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb247-4"><a href="stochastic-gradient-descent.html#cb247-4"></a>x1 =<span class="st"> </span><span class="kw">rnorm</span>(n)</span>
<span id="cb247-5"><a href="stochastic-gradient-descent.html#cb247-5"></a>x2 =<span class="st"> </span><span class="kw">rnorm</span>(n)</span>
<span id="cb247-6"><a href="stochastic-gradient-descent.html#cb247-6"></a>y  =<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="fl">.5</span><span class="op">*</span>x1 <span class="op">+</span><span class="st"> </span><span class="fl">.2</span><span class="op">*</span>x2 <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</span>
<span id="cb247-7"><a href="stochastic-gradient-descent.html#cb247-7"></a>X  =<span class="st"> </span><span class="kw">cbind</span>(<span class="dt">Intercept =</span> <span class="dv">1</span>, x1, x2)</span></code></pre></div>
</div>
<div id="stochastic-gradient-descent-algorithm" class="section level2">
<h2>Stochastic Gradient Descent Algorithm</h2>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="stochastic-gradient-descent.html#cb248-1"></a>sgd =<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb248-2"><a href="stochastic-gradient-descent.html#cb248-2"></a>  par,                                      <span class="co"># parameter estimates</span></span>
<span id="cb248-3"><a href="stochastic-gradient-descent.html#cb248-3"></a>  X,                                        <span class="co"># model matrix</span></span>
<span id="cb248-4"><a href="stochastic-gradient-descent.html#cb248-4"></a>  y,                                        <span class="co"># target variable</span></span>
<span id="cb248-5"><a href="stochastic-gradient-descent.html#cb248-5"></a>  <span class="dt">stepsize =</span> <span class="dv">1</span>,                             <span class="co"># the learning rate</span></span>
<span id="cb248-6"><a href="stochastic-gradient-descent.html#cb248-6"></a>  <span class="dt">stepsizeTau =</span> <span class="dv">0</span>,                          <span class="co"># if &gt; 0, a check on the LR at early iterations</span></span>
<span id="cb248-7"><a href="stochastic-gradient-descent.html#cb248-7"></a>  <span class="dt">average =</span> <span class="ot">FALSE</span></span>
<span id="cb248-8"><a href="stochastic-gradient-descent.html#cb248-8"></a>){</span>
<span id="cb248-9"><a href="stochastic-gradient-descent.html#cb248-9"></a>  </span>
<span id="cb248-10"><a href="stochastic-gradient-descent.html#cb248-10"></a>  <span class="co"># initialize</span></span>
<span id="cb248-11"><a href="stochastic-gradient-descent.html#cb248-11"></a>  beta =<span class="st"> </span>par</span>
<span id="cb248-12"><a href="stochastic-gradient-descent.html#cb248-12"></a>  <span class="kw">names</span>(beta) =<span class="st"> </span><span class="kw">colnames</span>(X)</span>
<span id="cb248-13"><a href="stochastic-gradient-descent.html#cb248-13"></a>  betamat =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(X), <span class="dt">ncol =</span> <span class="kw">length</span>(beta))      <span class="co"># Collect all estimates</span></span>
<span id="cb248-14"><a href="stochastic-gradient-descent.html#cb248-14"></a>  fits =<span class="st"> </span><span class="ot">NA</span>                                              <span class="co"># fitted values</span></span>
<span id="cb248-15"><a href="stochastic-gradient-descent.html#cb248-15"></a>  s =<span class="st"> </span><span class="dv">0</span>                                                  <span class="co"># adagrad per parameter learning rate adjustment</span></span>
<span id="cb248-16"><a href="stochastic-gradient-descent.html#cb248-16"></a>  loss =<span class="st"> </span><span class="ot">NA</span>                                              <span class="co"># Collect loss at each point</span></span>
<span id="cb248-17"><a href="stochastic-gradient-descent.html#cb248-17"></a>  </span>
<span id="cb248-18"><a href="stochastic-gradient-descent.html#cb248-18"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(X)) {</span>
<span id="cb248-19"><a href="stochastic-gradient-descent.html#cb248-19"></a>    Xi   =<span class="st"> </span>X[i, , drop =<span class="st"> </span><span class="ot">FALSE</span>]</span>
<span id="cb248-20"><a href="stochastic-gradient-descent.html#cb248-20"></a>    yi   =<span class="st"> </span>y[i]</span>
<span id="cb248-21"><a href="stochastic-gradient-descent.html#cb248-21"></a>    LP   =<span class="st"> </span>Xi <span class="op">%*%</span><span class="st"> </span>beta                                   <span class="co"># matrix operations not necessary, </span></span>
<span id="cb248-22"><a href="stochastic-gradient-descent.html#cb248-22"></a>    grad =<span class="st"> </span><span class="kw">t</span>(Xi) <span class="op">%*%</span><span class="st"> </span>(LP <span class="op">-</span><span class="st"> </span>yi)                           <span class="co"># but makes consistent with the  standard gd R file</span></span>
<span id="cb248-23"><a href="stochastic-gradient-descent.html#cb248-23"></a>    s    =<span class="st"> </span>s <span class="op">+</span><span class="st"> </span>grad<span class="op">^</span><span class="dv">2</span></span>
<span id="cb248-24"><a href="stochastic-gradient-descent.html#cb248-24"></a>    beta =<span class="st"> </span>beta <span class="op">-</span><span class="st"> </span>stepsize <span class="op">*</span><span class="st"> </span>grad<span class="op">/</span>(stepsizeTau <span class="op">+</span><span class="st"> </span><span class="kw">sqrt</span>(s))     <span class="co"># adagrad approach</span></span>
<span id="cb248-25"><a href="stochastic-gradient-descent.html#cb248-25"></a>    </span>
<span id="cb248-26"><a href="stochastic-gradient-descent.html#cb248-26"></a>    <span class="cf">if</span> (average <span class="op">&amp;</span><span class="st"> </span>i <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {</span>
<span id="cb248-27"><a href="stochastic-gradient-descent.html#cb248-27"></a>      beta =<span class="st">  </span>beta <span class="op">-</span><span class="st"> </span><span class="dv">1</span><span class="op">/</span>i <span class="op">*</span><span class="st"> </span>(betamat[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, ] <span class="op">-</span><span class="st"> </span>beta)          <span class="co"># a variation</span></span>
<span id="cb248-28"><a href="stochastic-gradient-descent.html#cb248-28"></a>    } </span>
<span id="cb248-29"><a href="stochastic-gradient-descent.html#cb248-29"></a>    </span>
<span id="cb248-30"><a href="stochastic-gradient-descent.html#cb248-30"></a>    betamat[i,] =<span class="st"> </span>beta</span>
<span id="cb248-31"><a href="stochastic-gradient-descent.html#cb248-31"></a>    fits[i]     =<span class="st"> </span>LP</span>
<span id="cb248-32"><a href="stochastic-gradient-descent.html#cb248-32"></a>    loss[i]     =<span class="st"> </span>(LP <span class="op">-</span><span class="st"> </span>yi)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb248-33"><a href="stochastic-gradient-descent.html#cb248-33"></a>  }</span>
<span id="cb248-34"><a href="stochastic-gradient-descent.html#cb248-34"></a>  </span>
<span id="cb248-35"><a href="stochastic-gradient-descent.html#cb248-35"></a>  LP =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>beta</span>
<span id="cb248-36"><a href="stochastic-gradient-descent.html#cb248-36"></a>  lastloss =<span class="st"> </span><span class="kw">crossprod</span>(LP <span class="op">-</span><span class="st"> </span>y)</span>
<span id="cb248-37"><a href="stochastic-gradient-descent.html#cb248-37"></a>  </span>
<span id="cb248-38"><a href="stochastic-gradient-descent.html#cb248-38"></a>  <span class="kw">list</span>(</span>
<span id="cb248-39"><a href="stochastic-gradient-descent.html#cb248-39"></a>    <span class="dt">par    =</span> beta,                                       <span class="co"># final estimates</span></span>
<span id="cb248-40"><a href="stochastic-gradient-descent.html#cb248-40"></a>    <span class="dt">parvec =</span> betamat,                                    <span class="co"># all estimates</span></span>
<span id="cb248-41"><a href="stochastic-gradient-descent.html#cb248-41"></a>    <span class="dt">loss   =</span> loss,                                       <span class="co"># observation level loss</span></span>
<span id="cb248-42"><a href="stochastic-gradient-descent.html#cb248-42"></a>    <span class="dt">RMSE   =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(lastloss)<span class="op">/</span><span class="kw">nrow</span>(X)),</span>
<span id="cb248-43"><a href="stochastic-gradient-descent.html#cb248-43"></a>    <span class="dt">fitted =</span> fits</span>
<span id="cb248-44"><a href="stochastic-gradient-descent.html#cb248-44"></a>  )</span>
<span id="cb248-45"><a href="stochastic-gradient-descent.html#cb248-45"></a>}</span></code></pre></div>
<div id="run-1" class="section level3">
<h3>Run</h3>
<p>Set starting values.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="stochastic-gradient-descent.html#cb249-1"></a>init =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>)</span></code></pre></div>
<p>For any particular data you might have to fiddle with the <code>stepsize</code>, perhaps
choosing one based on cross-validation with old data.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="stochastic-gradient-descent.html#cb250-1"></a>sgd_result =<span class="st"> </span><span class="kw">sgd</span>(</span>
<span id="cb250-2"><a href="stochastic-gradient-descent.html#cb250-2"></a>  init,</span>
<span id="cb250-3"><a href="stochastic-gradient-descent.html#cb250-3"></a>  <span class="dt">X =</span> X,</span>
<span id="cb250-4"><a href="stochastic-gradient-descent.html#cb250-4"></a>  <span class="dt">y =</span> y,</span>
<span id="cb250-5"><a href="stochastic-gradient-descent.html#cb250-5"></a>  <span class="dt">stepsize =</span> <span class="fl">.1</span>,</span>
<span id="cb250-6"><a href="stochastic-gradient-descent.html#cb250-6"></a>  <span class="dt">stepsizeTau =</span> <span class="fl">.5</span>,</span>
<span id="cb250-7"><a href="stochastic-gradient-descent.html#cb250-7"></a>  <span class="dt">average =</span> <span class="ot">FALSE</span></span>
<span id="cb250-8"><a href="stochastic-gradient-descent.html#cb250-8"></a>)</span>
<span id="cb250-9"><a href="stochastic-gradient-descent.html#cb250-9"></a></span>
<span id="cb250-10"><a href="stochastic-gradient-descent.html#cb250-10"></a><span class="kw">str</span>(sgd_result)</span></code></pre></div>
<pre><code>List of 5
 $ par   : num [1:3, 1] 1.024 0.537 0.148
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:3] &quot;Intercept&quot; &quot;x1&quot; &quot;x2&quot;
  .. ..$ : NULL
 $ parvec: num [1:1000, 1:3] -0.06208 -0.00264 0.04781 0.09866 0.08242 ...
 $ loss  : num [1:1000] 0.67 1.261 1.365 2.043 0.215 ...
 $ RMSE  : num 1.01
 $ fitted: num [1:1000] 0 -0.0236 -0.0446 -0.2828 0.1634 ...</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="stochastic-gradient-descent.html#cb252-1"></a>sgd_result<span class="op">$</span>par</span></code></pre></div>
<pre><code>               [,1]
Intercept 1.0241049
x1        0.5368198
x2        0.1478470</code></pre>
</div>
<div id="comparison-18" class="section level3">
<h3>Comparison</h3>
<p>We can compare to standard linear regression.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="stochastic-gradient-descent.html#cb254-1"></a><span class="co"># summary(lm(y ~ x1 + x2))</span></span>
<span id="cb254-2"><a href="stochastic-gradient-descent.html#cb254-2"></a>coef1 =<span class="st"> </span><span class="kw">coef</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2))</span>
<span id="cb254-3"><a href="stochastic-gradient-descent.html#cb254-3"></a></span>
<span id="cb254-4"><a href="stochastic-gradient-descent.html#cb254-4"></a><span class="kw">rbind</span>(</span>
<span id="cb254-5"><a href="stochastic-gradient-descent.html#cb254-5"></a>  <span class="dt">sgd_result =</span> sgd_result<span class="op">$</span>par[, <span class="dv">1</span>],</span>
<span id="cb254-6"><a href="stochastic-gradient-descent.html#cb254-6"></a>  <span class="dt">lm =</span> coef1</span>
<span id="cb254-7"><a href="stochastic-gradient-descent.html#cb254-7"></a>)</span></code></pre></div>
<pre><code>           Intercept        x1        x2
sgd_result  1.024105 0.5368198 0.1478470
lm          1.029957 0.5177020 0.1631026</code></pre>
</div>
<div id="visualize-estimates" class="section level3">
<h3>Visualize Estimates</h3>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="stochastic-gradient-descent.html#cb256-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb256-2"><a href="stochastic-gradient-descent.html#cb256-2"></a></span>
<span id="cb256-3"><a href="stochastic-gradient-descent.html#cb256-3"></a>gd =<span class="st"> </span><span class="kw">data.frame</span>(sgd_result<span class="op">$</span>parvec) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb256-4"><a href="stochastic-gradient-descent.html#cb256-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Iteration =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>())</span>
<span id="cb256-5"><a href="stochastic-gradient-descent.html#cb256-5"></a></span>
<span id="cb256-6"><a href="stochastic-gradient-descent.html#cb256-6"></a>gd =<span class="st"> </span>gd <span class="op">%&gt;%</span></span>
<span id="cb256-7"><a href="stochastic-gradient-descent.html#cb256-7"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span>Iteration,</span>
<span id="cb256-8"><a href="stochastic-gradient-descent.html#cb256-8"></a>               <span class="dt">names_to =</span> <span class="st">&#39;Parameter&#39;</span>,</span>
<span id="cb256-9"><a href="stochastic-gradient-descent.html#cb256-9"></a>               <span class="dt">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb256-10"><a href="stochastic-gradient-descent.html#cb256-10"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Parameter =</span> <span class="kw">factor</span>(Parameter, <span class="dt">labels =</span> <span class="kw">colnames</span>(X)))</span>
<span id="cb256-11"><a href="stochastic-gradient-descent.html#cb256-11"></a></span>
<span id="cb256-12"><a href="stochastic-gradient-descent.html#cb256-12"></a><span class="kw">ggplot</span>(<span class="kw">aes</span>(</span>
<span id="cb256-13"><a href="stochastic-gradient-descent.html#cb256-13"></a>  <span class="dt">x =</span> Iteration,</span>
<span id="cb256-14"><a href="stochastic-gradient-descent.html#cb256-14"></a>  <span class="dt">y =</span> Value,</span>
<span id="cb256-15"><a href="stochastic-gradient-descent.html#cb256-15"></a>  <span class="dt">group =</span> Parameter,</span>
<span id="cb256-16"><a href="stochastic-gradient-descent.html#cb256-16"></a>  <span class="dt">color =</span> Parameter</span>
<span id="cb256-17"><a href="stochastic-gradient-descent.html#cb256-17"></a>),</span>
<span id="cb256-18"><a href="stochastic-gradient-descent.html#cb256-18"></a><span class="dt">data =</span> gd) <span class="op">+</span></span>
<span id="cb256-19"><a href="stochastic-gradient-descent.html#cb256-19"></a><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></span>
<span id="cb256-20"><a href="stochastic-gradient-descent.html#cb256-20"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(gd, Iteration <span class="op">==</span><span class="st"> </span>n), <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb256-21"><a href="stochastic-gradient-descent.html#cb256-21"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb256-22"><a href="stochastic-gradient-descent.html#cb256-22"></a>    <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(Value, <span class="dv">2</span>)),</span>
<span id="cb256-23"><a href="stochastic-gradient-descent.html#cb256-23"></a>    <span class="dt">hjust =</span> <span class="fl">-.5</span>,</span>
<span id="cb256-24"><a href="stochastic-gradient-descent.html#cb256-24"></a>    <span class="dt">angle =</span> <span class="dv">45</span>,</span>
<span id="cb256-25"><a href="stochastic-gradient-descent.html#cb256-25"></a>    <span class="dt">size  =</span> <span class="dv">4</span>,</span>
<span id="cb256-26"><a href="stochastic-gradient-descent.html#cb256-26"></a>    <span class="dt">data  =</span> <span class="kw">filter</span>(gd, Iteration <span class="op">==</span><span class="st"> </span>n)</span>
<span id="cb256-27"><a href="stochastic-gradient-descent.html#cb256-27"></a>  ) <span class="op">+</span></span>
<span id="cb256-28"><a href="stochastic-gradient-descent.html#cb256-28"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="model-demos_files/figure-html/sgd-visualize-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="data-set-shift" class="section level2">
<h2>Data Set Shift</h2>
<p>This data includes a shift of the previous data.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="stochastic-gradient-descent.html#cb257-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb257-2"><a href="stochastic-gradient-descent.html#cb257-2"></a></span>
<span id="cb257-3"><a href="stochastic-gradient-descent.html#cb257-3"></a>n2   =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb257-4"><a href="stochastic-gradient-descent.html#cb257-4"></a>x1<span class="fl">.2</span> =<span class="st"> </span><span class="kw">rnorm</span>(n2)</span>
<span id="cb257-5"><a href="stochastic-gradient-descent.html#cb257-5"></a>x2<span class="fl">.2</span> =<span class="st"> </span><span class="kw">rnorm</span>(n2)</span>
<span id="cb257-6"><a href="stochastic-gradient-descent.html#cb257-6"></a>y2 =<span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span><span class="fl">.25</span><span class="op">*</span>x1<span class="fl">.2</span> <span class="op">-</span><span class="st"> </span><span class="fl">.25</span><span class="op">*</span>x2<span class="fl">.2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n2)</span>
<span id="cb257-7"><a href="stochastic-gradient-descent.html#cb257-7"></a>X2 =<span class="st"> </span><span class="kw">rbind</span>(X, <span class="kw">cbind</span>(<span class="dv">1</span>, x1<span class="fl">.2</span>, x2<span class="fl">.2</span>))</span>
<span id="cb257-8"><a href="stochastic-gradient-descent.html#cb257-8"></a>coef2 =<span class="st"> </span><span class="kw">coef</span>(<span class="kw">lm</span>(y2 <span class="op">~</span><span class="st"> </span>x1<span class="fl">.2</span> <span class="op">+</span><span class="st"> </span>x2<span class="fl">.2</span>))</span>
<span id="cb257-9"><a href="stochastic-gradient-descent.html#cb257-9"></a>y2 =<span class="st"> </span><span class="kw">c</span>(y, y2)</span>
<span id="cb257-10"><a href="stochastic-gradient-descent.html#cb257-10"></a></span>
<span id="cb257-11"><a href="stochastic-gradient-descent.html#cb257-11"></a>n3    =<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb257-12"><a href="stochastic-gradient-descent.html#cb257-12"></a>x1<span class="fl">.3</span>  =<span class="st"> </span><span class="kw">rnorm</span>(n3)</span>
<span id="cb257-13"><a href="stochastic-gradient-descent.html#cb257-13"></a>x2<span class="fl">.3</span>  =<span class="st"> </span><span class="kw">rnorm</span>(n3)</span>
<span id="cb257-14"><a href="stochastic-gradient-descent.html#cb257-14"></a>y3    =<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">.25</span><span class="op">*</span>x1<span class="fl">.3</span> <span class="op">+</span><span class="st"> </span><span class="fl">.25</span><span class="op">*</span>x2<span class="fl">.3</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n3)</span>
<span id="cb257-15"><a href="stochastic-gradient-descent.html#cb257-15"></a>coef3 =<span class="st"> </span><span class="kw">coef</span>(<span class="kw">lm</span>(y3 <span class="op">~</span><span class="st"> </span>x1<span class="fl">.3</span> <span class="op">+</span><span class="st"> </span>x2<span class="fl">.3</span>))</span>
<span id="cb257-16"><a href="stochastic-gradient-descent.html#cb257-16"></a></span>
<span id="cb257-17"><a href="stochastic-gradient-descent.html#cb257-17"></a>X3 =<span class="st"> </span><span class="kw">rbind</span>(X2, <span class="kw">cbind</span>(<span class="dv">1</span>, x1<span class="fl">.3</span>, x2<span class="fl">.3</span>))</span>
<span id="cb257-18"><a href="stochastic-gradient-descent.html#cb257-18"></a>y3 =<span class="st"> </span><span class="kw">c</span>(y2, y3)</span></code></pre></div>
<div id="run-2" class="section level3">
<h3>Run</h3>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="stochastic-gradient-descent.html#cb258-1"></a>sgd_result2 =<span class="st"> </span><span class="kw">sgd</span>(</span>
<span id="cb258-2"><a href="stochastic-gradient-descent.html#cb258-2"></a>  init,</span>
<span id="cb258-3"><a href="stochastic-gradient-descent.html#cb258-3"></a>  <span class="dt">X =</span> X3,</span>
<span id="cb258-4"><a href="stochastic-gradient-descent.html#cb258-4"></a>  <span class="dt">y =</span> y3,</span>
<span id="cb258-5"><a href="stochastic-gradient-descent.html#cb258-5"></a>  <span class="dt">stepsize =</span> <span class="dv">1</span>,</span>
<span id="cb258-6"><a href="stochastic-gradient-descent.html#cb258-6"></a>  <span class="dt">stepsizeTau =</span> <span class="dv">0</span>,</span>
<span id="cb258-7"><a href="stochastic-gradient-descent.html#cb258-7"></a>  <span class="dt">average =</span> <span class="ot">FALSE</span></span>
<span id="cb258-8"><a href="stochastic-gradient-descent.html#cb258-8"></a>)</span>
<span id="cb258-9"><a href="stochastic-gradient-descent.html#cb258-9"></a></span>
<span id="cb258-10"><a href="stochastic-gradient-descent.html#cb258-10"></a><span class="kw">str</span>(sgd_result2)</span></code></pre></div>
<pre><code>List of 5
 $ par   : num [1:3, 1] 0.821 -0.223 0.211
  ..- attr(*, &quot;dimnames&quot;)=List of 2
  .. ..$ : chr [1:3] &quot;Intercept&quot; &quot;x1&quot; &quot;x2&quot;
  .. ..$ : NULL
 $ parvec: num [1:3000, 1:3] -1 -0.119 0.624 1.531 1.063 ...
 $ loss  : num [1:3000] 0.67 2.31 3.69 30.99 10.58 ...
 $ RMSE  : num 1.57
 $ fitted: num [1:3000] 0 -0.421 -0.797 -4.421 2.952 ...</code></pre>
</div>
<div id="comparison-19" class="section level3">
<h3>Comparison</h3>
<p>Compare with <code>lm</code> for each data part.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="stochastic-gradient-descent.html#cb260-1"></a>sgd_result2<span class="op">$</span>parvec[<span class="kw">c</span>(n, n <span class="op">+</span><span class="st"> </span>n2, n <span class="op">+</span><span class="st"> </span>n2 <span class="op">+</span><span class="st"> </span>n3), ]</span></code></pre></div>
<pre><code>           [,1]       [,2]       [,3]
[1,]  1.0859378  0.5128904  0.1457697
[2,] -0.9246994  0.2945723 -0.2941759
[3,]  0.8213521 -0.2229918  0.2112883</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="stochastic-gradient-descent.html#cb262-1"></a><span class="kw">rbind</span>(coef1, coef2, coef3)</span></code></pre></div>
<pre><code>      (Intercept)         x1         x2
coef1   1.0299573  0.5177020  0.1631026
coef2  -0.9700427  0.2677020 -0.2868974
coef3   1.0453166 -0.2358521  0.2418489</code></pre>
</div>
<div id="visualize-estimates-1" class="section level3">
<h3>Visualize Estimates</h3>
<p>Visualize estimates.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="stochastic-gradient-descent.html#cb264-1"></a>gd =<span class="st"> </span><span class="kw">data.frame</span>(sgd_result2<span class="op">$</span>parvec) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb264-2"><a href="stochastic-gradient-descent.html#cb264-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Iteration =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>())</span>
<span id="cb264-3"><a href="stochastic-gradient-descent.html#cb264-3"></a></span>
<span id="cb264-4"><a href="stochastic-gradient-descent.html#cb264-4"></a>gd =<span class="st"> </span>gd <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb264-5"><a href="stochastic-gradient-descent.html#cb264-5"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span>Iteration,</span>
<span id="cb264-6"><a href="stochastic-gradient-descent.html#cb264-6"></a>               <span class="dt">names_to =</span> <span class="st">&#39;Parameter&#39;</span>, </span>
<span id="cb264-7"><a href="stochastic-gradient-descent.html#cb264-7"></a>               <span class="dt">values_to =</span> <span class="st">&#39;Value&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb264-8"><a href="stochastic-gradient-descent.html#cb264-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Parameter =</span> <span class="kw">factor</span>(Parameter, <span class="dt">labels =</span> <span class="kw">colnames</span>(X)))</span>
<span id="cb264-9"><a href="stochastic-gradient-descent.html#cb264-9"></a></span>
<span id="cb264-10"><a href="stochastic-gradient-descent.html#cb264-10"></a></span>
<span id="cb264-11"><a href="stochastic-gradient-descent.html#cb264-11"></a><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Iteration,</span>
<span id="cb264-12"><a href="stochastic-gradient-descent.html#cb264-12"></a>           <span class="dt">y =</span> Value,</span>
<span id="cb264-13"><a href="stochastic-gradient-descent.html#cb264-13"></a>           <span class="dt">group =</span> Parameter,</span>
<span id="cb264-14"><a href="stochastic-gradient-descent.html#cb264-14"></a>           <span class="dt">color =</span> Parameter</span>
<span id="cb264-15"><a href="stochastic-gradient-descent.html#cb264-15"></a>           ),</span>
<span id="cb264-16"><a href="stochastic-gradient-descent.html#cb264-16"></a>       <span class="dt">data =</span> gd) <span class="op">+</span></span>
<span id="cb264-17"><a href="stochastic-gradient-descent.html#cb264-17"></a><span class="st">  </span><span class="kw">geom_path</span>() <span class="op">+</span></span>
<span id="cb264-18"><a href="stochastic-gradient-descent.html#cb264-18"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(gd, Iteration <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(n, n <span class="op">+</span><span class="st"> </span>n2, n <span class="op">+</span><span class="st"> </span>n2 <span class="op">+</span><span class="st"> </span>n3)),</span>
<span id="cb264-19"><a href="stochastic-gradient-descent.html#cb264-19"></a>             <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb264-20"><a href="stochastic-gradient-descent.html#cb264-20"></a><span class="st">  </span><span class="kw">geom_text</span>(</span>
<span id="cb264-21"><a href="stochastic-gradient-descent.html#cb264-21"></a>    <span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">round</span>(Value, <span class="dv">2</span>)),</span>
<span id="cb264-22"><a href="stochastic-gradient-descent.html#cb264-22"></a>    <span class="dt">hjust =</span> <span class="fl">-.5</span>,</span>
<span id="cb264-23"><a href="stochastic-gradient-descent.html#cb264-23"></a>    <span class="dt">angle =</span> <span class="dv">45</span>,</span>
<span id="cb264-24"><a href="stochastic-gradient-descent.html#cb264-24"></a>    <span class="dt">data =</span> <span class="kw">filter</span>(gd, Iteration <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(n, n <span class="op">+</span><span class="st"> </span>n2, n <span class="op">+</span><span class="st"> </span>n2 <span class="op">+</span><span class="st"> </span>n3)),</span>
<span id="cb264-25"><a href="stochastic-gradient-descent.html#cb264-25"></a>    <span class="dt">size =</span> <span class="dv">4</span>,</span>
<span id="cb264-26"><a href="stochastic-gradient-descent.html#cb264-26"></a>    <span class="dt">show.legend =</span> <span class="ot">FALSE</span></span>
<span id="cb264-27"><a href="stochastic-gradient-descent.html#cb264-27"></a>  ) <span class="op">+</span></span>
<span id="cb264-28"><a href="stochastic-gradient-descent.html#cb264-28"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="model-demos_files/figure-html/sgd-visualize-2-1.svg" width="75%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="source-17" class="section level2">
<h2>Source</h2>
<p>Base R source code found at <a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/stochastic_gradient_descent.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/stochastic_gradient_descent.R</a></p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="gradient-descent.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="supplemental.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "facebook", "linkedin", "google", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/m-clark/models-by-example/blob/master/stochastic-gradient-descent.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"df_print": "kable",
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
