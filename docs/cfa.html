<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Confirmatory Factor Analysis | Model Estimation by Example</title>
  <meta name="description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Confirmatory Factor Analysis | Model Estimation by Example" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/models-by-example/" />
  <meta property="og:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />
  <meta property="og:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="github-repo" content="m-clark/models-by-example/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Confirmatory Factor Analysis | Model Estimation by Example" />
  
  <meta name="twitter:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="twitter:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />



<meta name="date" content="2020-11-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon" />
<link rel="prev" href="cox.html"/>
<link rel="next" href="penalized-maximum-likelihood.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/book.css" type="text/css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="./">Model Estimation by Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>Models</b></span></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i>Standard Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#data-setup"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#estimation"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#comparison"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i>Standard Logistic</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#data-setup-1"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#estimation-1"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#comparison-1"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html"><i class="fa fa-check"></i>One-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#main-function"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#data-setup-2"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#estimation-2"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#comparison-2"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#source-2"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html"><i class="fa fa-check"></i>Two-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#main-function-1"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#data-setup-3"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#estimation-3"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#comparison-3"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#source-3"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html"><i class="fa fa-check"></i>Mixed Model via ML</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#maximum-likelihood-estimation"><i class="fa fa-check"></i>Maximum Likelihood Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#main-function-2"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#results"><i class="fa fa-check"></i>Results</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#issues-with-ml-estimation"><i class="fa fa-check"></i>Issues with ML estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#link-with-penalized-regression"><i class="fa fa-check"></i>Link with penalized regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#source-4"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html"><i class="fa fa-check"></i>Probit &amp; Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#standard-probit"><i class="fa fa-check"></i>Standard Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#examples"><i class="fa fa-check"></i>Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#bivariate-probit"><i class="fa fa-check"></i>Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#source-5"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html"><i class="fa fa-check"></i>Heckman Selection</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#data-setup-4"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#two-step-approach"><i class="fa fa-check"></i>Two step approach</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-1-probit-model"><i class="fa fa-check"></i>Step 1: Probit Model</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-2-estimate-via-linear-regression"><i class="fa fa-check"></i>Step 2: Estimate via Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#maximum-likelihood"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#comparison-4"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#source-6"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html"><i class="fa fa-check"></i>Marginal Structural Model</a>
<ul>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#data-setup-5"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#create-the-weights"><i class="fa fa-check"></i>Create the Weights</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#estimation-4"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#comparison-5"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#source-7"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html"><i class="fa fa-check"></i>Tobit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-an-upper-limit"><i class="fa fa-check"></i>Demonstrate Censoring with an Upper Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#data-setup-6"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-6"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-a-lower-limit"><i class="fa fa-check"></i>Demonstrate censoring with a Lower Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-7"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#source-8"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html"><i class="fa fa-check"></i>Naive Bayes</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#initialization"><i class="fa fa-check"></i>Initialization</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#comparison-8"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#source-9"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i>Multinomial</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#standard-categorical-model"><i class="fa fa-check"></i>Standard (Categorical) Model</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#data-setup-7"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#multinomial-via-maximum-likelihood"><i class="fa fa-check"></i>Multinomial via Maximum Likelihood</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-9"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#alternative-specific-and-constant-variables"><i class="fa fa-check"></i>Alternative specific and constant variables</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-10"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#source-10"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i>Ordinal</a>
<ul>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#estimation-5"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#comparison-11"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#source-11"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html"><i class="fa fa-check"></i>Markov Chain Model</a>
<ul>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#data-setup-8"><i class="fa fa-check"></i>Data Setup</a>
<ul>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#data-functions"><i class="fa fa-check"></i>Data Functions</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#two-states-demo"><i class="fa fa-check"></i>Two states Demo</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#three-states-demo"><i class="fa fa-check"></i>Three states demo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#function"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#estimation-6"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#comparison-12"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="markov.html"><a href="markov.html#source-12"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html"><i class="fa fa-check"></i>Hidden Markov Model</a>
<ul>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#data-setup-9"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#function-1"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#estimation-7"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#supplemental-demo"><i class="fa fa-check"></i>Supplemental demo</a></li>
<li class="chapter" data-level="" data-path="hmm.html"><a href="hmm.html#source-13"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html"><i class="fa fa-check"></i>Quantile Regression</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#loss-function"><i class="fa fa-check"></i>Loss function</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#median-estimation"><i class="fa fa-check"></i>Median estimation</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#other-quantiles"><i class="fa fa-check"></i>Other quantiles</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#visualize"><i class="fa fa-check"></i>Visualize</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#source-14"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html"><i class="fa fa-check"></i>Cubic Spline Model</a>
<ul>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#data-setup-10"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#functions-2"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-1"><i class="fa fa-check"></i>Example 1</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-2"><i class="fa fa-check"></i>Example 2</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#source-15"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html"><i class="fa fa-check"></i>Hurdle Model</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#poisson"><i class="fa fa-check"></i>Poisson</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#data-setup-11"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#function-2"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#estimation-8"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#comparison-13"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#negative-binomial"><i class="fa fa-check"></i>Negative Binomial</a>
<ul>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#function-3"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#estimation-9"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#comparison-14"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hurdle.html"><a href="hurdle.html#source-16"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html"><i class="fa fa-check"></i>Zero-Inflated Model</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#poisson-1"><i class="fa fa-check"></i>Poisson</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#data-setup-12"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#function-4"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#estimation-10"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#comparison-15"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#negative-binomial-1"><i class="fa fa-check"></i>Negative Binomial</a>
<ul>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#function-5"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#estimation-11"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#comparison-16"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#supplemental-example"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="zi.html"><a href="zi.html#source-17"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html"><i class="fa fa-check"></i>Cox Survival</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#standard-proportional-hazards"><i class="fa fa-check"></i>Standard Proportional Hazards</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-13"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-6"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-12"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-17"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#time-varying-coefficients"><i class="fa fa-check"></i>Time-varying coefficients</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-14"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-7"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-13"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-18"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#stratified-cox-model"><i class="fa fa-check"></i>Stratified Cox Model</a>
<ul>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#data-setup-15"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#function-8"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#estimation-14"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#comparison-19"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cox.html"><a href="cox.html#source-18"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html"><i class="fa fa-check"></i>Confirmatory Factor Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#data-setup-16"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#primary-functions"><i class="fa fa-check"></i>Primary Functions</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#estimation-15"><i class="fa fa-check"></i>Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#raw"><i class="fa fa-check"></i>Raw</a></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#standardized"><i class="fa fa-check"></i>Standardized</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#comparison-20"><i class="fa fa-check"></i>Comparison</a>
<ul>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#mplus"><i class="fa fa-check"></i>Mplus</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cfa.html"><a href="cfa.html#source-19"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Algorithms</b></span></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html"><i class="fa fa-check"></i>Penalized Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-17"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#functions-3"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#estimation-16"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-21"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-20"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i>L1 (lasso) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#functions-4"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#data-setup-18"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#comparison-22"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#source-21"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i>L2 (ridge) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#comparison-23"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#source-22"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html"><i class="fa fa-check"></i>Newton and IRLS</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#data-setup-19"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#functions-5"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#newtons-method"><i class="fa fa-check"></i>Newton’s Method</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#irls"><i class="fa fa-check"></i>IRLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#comparison-24"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#source-23"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html"><i class="fa fa-check"></i>Nelder Mead</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#first-version"><i class="fa fa-check"></i>First Version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-3"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#second-version"><i class="fa fa-check"></i>Second Version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-function"><i class="fa fa-check"></i>Example Function</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model-1"><i class="fa fa-check"></i>A Regression Model</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#comparison-26"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#source-24"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html"><i class="fa fa-check"></i>Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#data-setup-21"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#gradient-descent-algorithm"><i class="fa fa-check"></i>Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#run"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#comparison-27"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#source-25"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html"><i class="fa fa-check"></i>Stochastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-22"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#main-function-3"><i class="fa fa-check"></i>Main Function</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-1"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-28"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-set-shift"><i class="fa fa-check"></i>Data Set Shift</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-2"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-29"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-1"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#source-26"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html"><i class="fa fa-check"></i>Expectation-Maximization</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#mixture-model"><i class="fa fa-check"></i>Mixture Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#data-setup-23"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-9"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#estimation-17"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#comparison-30"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#supplemental-example-1"><i class="fa fa-check"></i>Supplemental Example</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-27"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#multivariate-mixture-model"><i class="fa fa-check"></i>Multivariate Mixture Model</a>
<ul>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#function-10"><i class="fa fa-check"></i>Function</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#example-1-old-faithful-eruptions"><i class="fa fa-check"></i>Example 1: Old Faithful eruptions</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#example-2-iris-data-set"><i class="fa fa-check"></i>Example 2: Iris data set</a></li>
<li class="chapter" data-level="" data-path="em.html"><a href="em.html#source-28"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Other</b></span></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html"><i class="fa fa-check"></i>Supplemental</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#other-languages"><i class="fa fa-check"></i>Other Languages</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#algorithms"><i class="fa fa-check"></i>Algorithms</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li class='after'">
   <a href="https://m-clark.github.io/">
      <img src="img/mc_logo.png" style="width:25%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo">
   </a>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a href="https://github.com/m-clark/">
         <i class="fab fa-github fa-2x" aria-hidden="true"></i>
      </a>
   </div>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
         <i class="fab fa-creative-commons fa-lg"></i>
         <i class="fab fa-creative-commons-by fa-lg"></i>
         <i class="fab fa-creative-commons-sa fa-lg"></i>
      </a>
   </div>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model Estimation by Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="confirmatory-factor-analysis" class="section level1">
<h1>Confirmatory Factor Analysis</h1>
<p>This mostly follows Bollen (1989) for maximum likelihood estimation of a confirmatory factor analysis. In the following example we will examine a situation where there are two underlying (correlated) latent variables for 8 observed responses. The code as is will only work with this toy data set. Setup uses the <span class="pack" style="">psych</span> and <span class="pack" style="">mvtnorm</span> packages, and results are checked against the <span class="pack" style="">lavaan</span> package.</p>
<div id="data-setup-16" class="section level2">
<h2>Data Setup</h2>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="cfa.html#cb328-1"></a><span class="kw">library</span>(mvtnorm)</span>
<span id="cb328-2"><a href="cfa.html#cb328-2"></a><span class="kw">library</span>(psych)</span>
<span id="cb328-3"><a href="cfa.html#cb328-3"></a></span>
<span id="cb328-4"><a href="cfa.html#cb328-4"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb328-5"><a href="cfa.html#cb328-5"></a></span>
<span id="cb328-6"><a href="cfa.html#cb328-6"></a><span class="co"># loading matrix</span></span>
<span id="cb328-7"><a href="cfa.html#cb328-7"></a>lambda =<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb328-8"><a href="cfa.html#cb328-8"></a>  <span class="kw">c</span>(<span class="dv">1</span>,.<span class="dv">5</span>,.<span class="dv">3</span>,.<span class="dv">6</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,</span>
<span id="cb328-9"><a href="cfa.html#cb328-9"></a>    <span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">7</span>,.<span class="dv">4</span>,.<span class="dv">5</span>),</span>
<span id="cb328-10"><a href="cfa.html#cb328-10"></a>  <span class="dt">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb328-11"><a href="cfa.html#cb328-11"></a>  <span class="dt">byrow =</span> <span class="ot">TRUE</span></span>
<span id="cb328-12"><a href="cfa.html#cb328-12"></a>)</span>
<span id="cb328-13"><a href="cfa.html#cb328-13"></a></span>
<span id="cb328-14"><a href="cfa.html#cb328-14"></a><span class="co"># correlation of factors</span></span>
<span id="cb328-15"><a href="cfa.html#cb328-15"></a>phi =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.25</span>, <span class="fl">.25</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)  </span>
<span id="cb328-16"><a href="cfa.html#cb328-16"></a></span>
<span id="cb328-17"><a href="cfa.html#cb328-17"></a><span class="co"># factors and some noise</span></span>
<span id="cb328-18"><a href="cfa.html#cb328-18"></a>factors =<span class="st"> </span><span class="kw">rmvnorm</span>(<span class="dv">1000</span>, <span class="dt">mean =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="dt">sigma =</span> phi, <span class="st">&quot;chol&quot;</span>)</span>
<span id="cb328-19"><a href="cfa.html#cb328-19"></a>e =<span class="st"> </span><span class="kw">rmvnorm</span>(<span class="dv">1000</span>, <span class="dt">sigma =</span> <span class="kw">diag</span>(<span class="dv">8</span>))</span>
<span id="cb328-20"><a href="cfa.html#cb328-20"></a></span>
<span id="cb328-21"><a href="cfa.html#cb328-21"></a><span class="co"># observed responses</span></span>
<span id="cb328-22"><a href="cfa.html#cb328-22"></a>y =<span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>factors<span class="op">%*%</span>lambda <span class="op">+</span><span class="st"> </span>e</span>
<span id="cb328-23"><a href="cfa.html#cb328-23"></a></span>
<span id="cb328-24"><a href="cfa.html#cb328-24"></a><span class="co"># Examine</span></span>
<span id="cb328-25"><a href="cfa.html#cb328-25"></a><span class="co">#dim(y)</span></span>
<span id="cb328-26"><a href="cfa.html#cb328-26"></a><span class="kw">describe</span>(y)</span></code></pre></div>
<pre><code>   vars    n  mean   sd median trimmed  mad   min  max range  skew kurtosis   se
X1    1 1000  0.05 1.44   0.05    0.05 1.42 -5.13 4.51  9.63  0.00     0.01 0.05
X2    2 1000  0.00 1.08  -0.01    0.00 1.04 -3.34 3.25  6.59  0.00    -0.06 0.03
X3    3 1000 -0.01 1.04   0.00   -0.01 1.01 -4.40 3.56  7.96 -0.07     0.27 0.03
X4    4 1000  0.00 1.14  -0.03   -0.01 1.13 -3.85 3.98  7.83  0.10     0.16 0.04
X5    5 1000  0.04 1.43   0.10    0.05 1.39 -4.43 5.21  9.63 -0.02     0.07 0.05
X6    6 1000 -0.02 1.22  -0.01   -0.02 1.27 -3.35 4.68  8.03  0.04    -0.10 0.04
X7    7 1000  0.02 1.06   0.01    0.01 1.05 -2.94 3.33  6.28  0.11    -0.09 0.03
X8    8 1000  0.00 1.14  -0.01    0.01 1.12 -3.27 3.47  6.73 -0.05     0.07 0.04</code></pre>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="cfa.html#cb330-1"></a><span class="kw">round</span>(<span class="kw">cor</span>(y), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>      [,1]   [,2]  [,3]  [,4]   [,5]  [,6]  [,7]  [,8]
[1,] 1.000  0.291 0.233 0.352  0.104 0.078 0.049 0.050
[2,] 0.291  1.000 0.145 0.228 -0.008 0.031 0.054 0.072
[3,] 0.233  0.145 1.000 0.171  0.006 0.066 0.026 0.079
[4,] 0.352  0.228 0.171 1.000  0.014 0.057 0.054 0.079
[5,] 0.104 -0.008 0.006 0.014  1.000 0.417 0.259 0.300
[6,] 0.078  0.031 0.066 0.057  0.417 1.000 0.201 0.273
[7,] 0.049  0.054 0.026 0.054  0.259 0.201 1.000 0.142
[8,] 0.050  0.072 0.079 0.079  0.300 0.273 0.142 1.000</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="cfa.html#cb332-1"></a><span class="co">#see the factor structure</span></span>
<span id="cb332-2"><a href="cfa.html#cb332-2"></a><span class="kw">cor.plot</span>(<span class="kw">cor</span>(y))</span></code></pre></div>
<p><img src="model-demos_files/figure-html/cfa-setup-1.svg" width="75%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="cfa.html#cb333-1"></a><span class="co"># example exploratory fa</span></span>
<span id="cb333-2"><a href="cfa.html#cb333-2"></a><span class="co">#fa(y, nfactors=2, rotate=&quot;oblimin&quot;) </span></span></code></pre></div>
</div>
<div id="primary-functions" class="section level2">
<h2>Primary Functions</h2>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="cfa.html#cb334-1"></a><span class="co"># measurement model, covariance approach</span></span>
<span id="cb334-2"><a href="cfa.html#cb334-2"></a>cfa_cov &lt;-<span class="st"> </span><span class="cf">function</span> (parms, data) {</span>
<span id="cb334-3"><a href="cfa.html#cb334-3"></a>  <span class="co"># Arguments- </span></span>
<span id="cb334-4"><a href="cfa.html#cb334-4"></a>  <span class="co"># parms: initial values (named)</span></span>
<span id="cb334-5"><a href="cfa.html#cb334-5"></a>  <span class="co"># data: raw data</span></span>
<span id="cb334-6"><a href="cfa.html#cb334-6"></a>  </span>
<span id="cb334-7"><a href="cfa.html#cb334-7"></a>  <span class="co"># Extract parameters by name</span></span>
<span id="cb334-8"><a href="cfa.html#cb334-8"></a>  </span>
<span id="cb334-9"><a href="cfa.html#cb334-9"></a>  <span class="kw">require</span>(psych) <span class="co"># for tr</span></span>
<span id="cb334-10"><a href="cfa.html#cb334-10"></a>  </span>
<span id="cb334-11"><a href="cfa.html#cb334-11"></a>  l1 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, parms[<span class="kw">grep</span>(<span class="st">&#39;l1&#39;</span>, <span class="kw">names</span>(parms))])      <span class="co"># loadings for factor 1</span></span>
<span id="cb334-12"><a href="cfa.html#cb334-12"></a>  l2 =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, parms[<span class="kw">grep</span>(<span class="st">&#39;l2&#39;</span>, <span class="kw">names</span>(parms))])      <span class="co"># loadings for factor 2</span></span>
<span id="cb334-13"><a href="cfa.html#cb334-13"></a>  cov0 =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;cov&#39;</span>, <span class="kw">names</span>(parms))]         <span class="co"># factor covariance, variances</span></span>
<span id="cb334-14"><a href="cfa.html#cb334-14"></a>  </span>
<span id="cb334-15"><a href="cfa.html#cb334-15"></a>  <span class="co"># Covariance matrix</span></span>
<span id="cb334-16"><a href="cfa.html#cb334-16"></a>  S =<span class="st"> </span><span class="kw">cov</span>(data)<span class="op">*</span>((<span class="kw">nrow</span>(data)<span class="op">-</span><span class="dv">1</span>)<span class="op">/</span><span class="kw">nrow</span>(data))       <span class="co"># ML covariance div by N rather than N-1, the multiplier adjusts</span></span>
<span id="cb334-17"><a href="cfa.html#cb334-17"></a>  </span>
<span id="cb334-18"><a href="cfa.html#cb334-18"></a>  <span class="co"># loading estimates</span></span>
<span id="cb334-19"><a href="cfa.html#cb334-19"></a>  lambda =<span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb334-20"><a href="cfa.html#cb334-20"></a>    <span class="kw">c</span>(l1, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(l2))),</span>
<span id="cb334-21"><a href="cfa.html#cb334-21"></a>    <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(l1)), l2)</span>
<span id="cb334-22"><a href="cfa.html#cb334-22"></a>  )</span>
<span id="cb334-23"><a href="cfa.html#cb334-23"></a>  </span>
<span id="cb334-24"><a href="cfa.html#cb334-24"></a>  <span class="co"># disturbances</span></span>
<span id="cb334-25"><a href="cfa.html#cb334-25"></a>  dist_init =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;dist&#39;</span>, <span class="kw">names</span>(parms))]    </span>
<span id="cb334-26"><a href="cfa.html#cb334-26"></a>  disturbs  =<span class="st"> </span><span class="kw">diag</span>(dist_init)</span>
<span id="cb334-27"><a href="cfa.html#cb334-27"></a>  </span>
<span id="cb334-28"><a href="cfa.html#cb334-28"></a>  <span class="co"># factor correlation</span></span>
<span id="cb334-29"><a href="cfa.html#cb334-29"></a>  phi_init =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(cov0[<span class="dv">1</span>], cov0[<span class="dv">2</span>], cov0[<span class="dv">2</span>], cov0[<span class="dv">3</span>]), <span class="dv">2</span>, <span class="dv">2</span>)  <span class="co">#factor cov/correlation matrix</span></span>
<span id="cb334-30"><a href="cfa.html#cb334-30"></a>  </span>
<span id="cb334-31"><a href="cfa.html#cb334-31"></a>  <span class="co"># other calculations and log likelihood</span></span>
<span id="cb334-32"><a href="cfa.html#cb334-32"></a>  sigtheta =<span class="st"> </span>lambda<span class="op">%*%</span>phi_init<span class="op">%*%</span><span class="kw">t</span>(lambda) <span class="op">+</span><span class="st"> </span>disturbs</span>
<span id="cb334-33"><a href="cfa.html#cb334-33"></a>  </span>
<span id="cb334-34"><a href="cfa.html#cb334-34"></a>  <span class="co"># in Bollen p + q (but for the purposes of this just p) = tr(data)</span></span>
<span id="cb334-35"><a href="cfa.html#cb334-35"></a>  pq =<span class="st"> </span><span class="kw">dim</span>(data)[<span class="dv">2</span>] </span>
<span id="cb334-36"><a href="cfa.html#cb334-36"></a>  </span>
<span id="cb334-37"><a href="cfa.html#cb334-37"></a>  <span class="co"># a reduced version; Bollen 1989 p.107</span></span>
<span id="cb334-38"><a href="cfa.html#cb334-38"></a>  <span class="co"># ll = -(log(det(sigtheta)) + tr(S%*%solve(sigtheta)) - log(det(S)) - pq) </span></span>
<span id="cb334-39"><a href="cfa.html#cb334-39"></a>  </span>
<span id="cb334-40"><a href="cfa.html#cb334-40"></a>  <span class="co"># should be same as Mplus H0 loglike</span></span>
<span id="cb334-41"><a href="cfa.html#cb334-41"></a>  ll =<span class="st"> </span>( (<span class="op">-</span><span class="kw">nrow</span>(data)<span class="op">*</span>pq<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>pi) ) <span class="op">-</span><span class="st"> </span></span>
<span id="cb334-42"><a href="cfa.html#cb334-42"></a><span class="st">    </span>(<span class="kw">nrow</span>(data)<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>( <span class="kw">log</span>(<span class="kw">det</span>(sigtheta)) <span class="op">+</span><span class="st"> </span><span class="kw">tr</span>(S<span class="op">%*%</span><span class="kw">solve</span>(sigtheta)) )</span>
<span id="cb334-43"><a href="cfa.html#cb334-43"></a>  </span>
<span id="cb334-44"><a href="cfa.html#cb334-44"></a>  ll</span>
<span id="cb334-45"><a href="cfa.html#cb334-45"></a>}</span></code></pre></div>
<p>Correlation approach for standardized results. Lines correspond to those in <code>cfa_cov</code>.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="cfa.html#cb335-1"></a>cfa_cor &lt;-<span class="st"> </span><span class="cf">function</span> (parms, data) {</span>
<span id="cb335-2"><a href="cfa.html#cb335-2"></a>  <span class="kw">require</span>(psych)</span>
<span id="cb335-3"><a href="cfa.html#cb335-3"></a>  </span>
<span id="cb335-4"><a href="cfa.html#cb335-4"></a>  l1 =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;l1&#39;</span>, <span class="kw">names</span>(parms))]      <span class="co"># loadings for factor 1</span></span>
<span id="cb335-5"><a href="cfa.html#cb335-5"></a>  l2 =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;l2&#39;</span>, <span class="kw">names</span>(parms))]      <span class="co"># loadings for factor 2</span></span>
<span id="cb335-6"><a href="cfa.html#cb335-6"></a>  cor0 =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;cor&#39;</span>, <span class="kw">names</span>(parms))]   <span class="co"># factor correlation</span></span>
<span id="cb335-7"><a href="cfa.html#cb335-7"></a>  </span>
<span id="cb335-8"><a href="cfa.html#cb335-8"></a>  S =<span class="st"> </span><span class="kw">cor</span>(data)</span>
<span id="cb335-9"><a href="cfa.html#cb335-9"></a>  </span>
<span id="cb335-10"><a href="cfa.html#cb335-10"></a>  lambda =<span class="st"> </span><span class="kw">cbind</span>(</span>
<span id="cb335-11"><a href="cfa.html#cb335-11"></a>    <span class="kw">c</span>(l1, <span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(l2))),</span>
<span id="cb335-12"><a href="cfa.html#cb335-12"></a>    <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="kw">length</span>(l1)), l2)</span>
<span id="cb335-13"><a href="cfa.html#cb335-13"></a>  )</span>
<span id="cb335-14"><a href="cfa.html#cb335-14"></a>  </span>
<span id="cb335-15"><a href="cfa.html#cb335-15"></a>  dist_init =<span class="st"> </span>parms[<span class="kw">grep</span>(<span class="st">&#39;dist&#39;</span>, <span class="kw">names</span>(parms))]</span>
<span id="cb335-16"><a href="cfa.html#cb335-16"></a>  disturbs  =<span class="st"> </span><span class="kw">diag</span>(dist_init)</span>
<span id="cb335-17"><a href="cfa.html#cb335-17"></a>  </span>
<span id="cb335-18"><a href="cfa.html#cb335-18"></a>  phi_init =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, cor0, cor0, <span class="dv">1</span>), <span class="dt">ncol=</span><span class="dv">2</span>)</span>
<span id="cb335-19"><a href="cfa.html#cb335-19"></a>  </span>
<span id="cb335-20"><a href="cfa.html#cb335-20"></a>  sigtheta =<span class="st"> </span>lambda<span class="op">%*%</span>phi_init<span class="op">%*%</span><span class="kw">t</span>(lambda) <span class="op">+</span><span class="st"> </span>disturbs</span>
<span id="cb335-21"><a href="cfa.html#cb335-21"></a>  pq =<span class="st"> </span><span class="kw">dim</span>(data)[<span class="dv">2</span>]</span>
<span id="cb335-22"><a href="cfa.html#cb335-22"></a>  </span>
<span id="cb335-23"><a href="cfa.html#cb335-23"></a>  <span class="co">#ll = ( log(det(sigtheta)) + tr(S%*%solve(sigtheta)) - log(det(S)) - pq )</span></span>
<span id="cb335-24"><a href="cfa.html#cb335-24"></a>  </span>
<span id="cb335-25"><a href="cfa.html#cb335-25"></a>  ll =<span class="st"> </span>( (<span class="op">-</span><span class="kw">nrow</span>(data)<span class="op">*</span>pq<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">2</span><span class="op">*</span>pi) ) <span class="op">-</span><span class="st"> </span></span>
<span id="cb335-26"><a href="cfa.html#cb335-26"></a><span class="st">    </span>(<span class="kw">nrow</span>(data)<span class="op">/</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>( <span class="kw">log</span>(<span class="kw">det</span>(sigtheta)) <span class="op">+</span><span class="st"> </span><span class="kw">tr</span>(S<span class="op">%*%</span><span class="kw">solve</span>(sigtheta)) )</span>
<span id="cb335-27"><a href="cfa.html#cb335-27"></a>  </span>
<span id="cb335-28"><a href="cfa.html#cb335-28"></a>  ll</span>
<span id="cb335-29"><a href="cfa.html#cb335-29"></a>}</span></code></pre></div>
</div>
<div id="estimation-15" class="section level2">
<h2>Estimation</h2>
<div id="raw" class="section level3">
<h3>Raw</h3>
<p>Set initial values.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="cfa.html#cb336-1"></a>par_init_cov =<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">6</span>), <span class="kw">rep</span>(.<span class="dv">05</span>, <span class="dv">8</span>), <span class="kw">rep</span>(.<span class="dv">5</span>, <span class="dv">3</span>)) </span>
<span id="cb336-2"><a href="cfa.html#cb336-2"></a><span class="kw">names</span>(par_init_cov) =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;l1&#39;</span>,<span class="st">&#39;l2&#39;</span>, <span class="st">&#39;dist&#39;</span>, <span class="st">&#39;cov&#39;</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">3</span>))</span></code></pre></div>
<p>Estimate and extract.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="cfa.html#cb337-1"></a>result_cov =<span class="st"> </span><span class="kw">optim</span>(</span>
<span id="cb337-2"><a href="cfa.html#cb337-2"></a>  <span class="dt">par  =</span> par_init_cov,</span>
<span id="cb337-3"><a href="cfa.html#cb337-3"></a>  <span class="dt">fn   =</span> cfa_cov,</span>
<span id="cb337-4"><a href="cfa.html#cb337-4"></a>  <span class="dt">data =</span> y,</span>
<span id="cb337-5"><a href="cfa.html#cb337-5"></a>  <span class="dt">method  =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb337-6"><a href="cfa.html#cb337-6"></a>  <span class="dt">lower   =</span> <span class="dv">0</span>,</span>
<span id="cb337-7"><a href="cfa.html#cb337-7"></a>  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale =</span> <span class="dv">-1</span>)</span>
<span id="cb337-8"><a href="cfa.html#cb337-8"></a>) </span>
<span id="cb337-9"><a href="cfa.html#cb337-9"></a></span>
<span id="cb337-10"><a href="cfa.html#cb337-10"></a>loadings_cov =<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb337-11"><a href="cfa.html#cb337-11"></a>  <span class="dt">f1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, result_cov<span class="op">$</span>par[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>)),</span>
<span id="cb337-12"><a href="cfa.html#cb337-12"></a>  <span class="dt">f2 =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="dv">1</span>, result_cov<span class="op">$</span>par[<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>])</span>
<span id="cb337-13"><a href="cfa.html#cb337-13"></a>)</span>
<span id="cb337-14"><a href="cfa.html#cb337-14"></a></span>
<span id="cb337-15"><a href="cfa.html#cb337-15"></a>disturbances_cov =<span class="st"> </span>result_cov<span class="op">$</span>par[<span class="dv">7</span><span class="op">:</span><span class="dv">14</span>]</span></code></pre></div>
</div>
<div id="standardized" class="section level3">
<h3>Standardized</h3>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="cfa.html#cb338-1"></a>par_init_cor =<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="kw">rep</span>(.<span class="dv">05</span>, <span class="dv">8</span>), <span class="dv">0</span>) <span class="co">#for cor</span></span>
<span id="cb338-2"><a href="cfa.html#cb338-2"></a><span class="kw">names</span>(par_init_cor) =<span class="st"> </span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;l1&#39;</span>, <span class="st">&#39;l2&#39;</span>, <span class="st">&#39;dist&#39;</span>, <span class="st">&#39;cor&#39;</span>), <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="cfa.html#cb339-1"></a>result_cor =<span class="st"> </span><span class="kw">optim</span>(</span>
<span id="cb339-2"><a href="cfa.html#cb339-2"></a>  <span class="dt">par  =</span> par_init_cor,</span>
<span id="cb339-3"><a href="cfa.html#cb339-3"></a>  <span class="dt">fn   =</span> cfa_cor,</span>
<span id="cb339-4"><a href="cfa.html#cb339-4"></a>  <span class="dt">data =</span> y,</span>
<span id="cb339-5"><a href="cfa.html#cb339-5"></a>  <span class="dt">method  =</span> <span class="st">&quot;L-BFGS-B&quot;</span>,</span>
<span id="cb339-6"><a href="cfa.html#cb339-6"></a>  <span class="dt">lower   =</span> <span class="dv">0</span>,</span>
<span id="cb339-7"><a href="cfa.html#cb339-7"></a>  <span class="dt">upper   =</span> <span class="dv">1</span>,</span>
<span id="cb339-8"><a href="cfa.html#cb339-8"></a>  <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">fnscale =</span> <span class="dv">-1</span>)</span>
<span id="cb339-9"><a href="cfa.html#cb339-9"></a>)</span>
<span id="cb339-10"><a href="cfa.html#cb339-10"></a></span>
<span id="cb339-11"><a href="cfa.html#cb339-11"></a>loadings_cor =<span class="st"> </span><span class="kw">matrix</span>(</span>
<span id="cb339-12"><a href="cfa.html#cb339-12"></a>  <span class="kw">c</span>(result_cor<span class="op">$</span>par[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), result_cor<span class="op">$</span>par[<span class="dv">5</span><span class="op">:</span><span class="dv">8</span>]), </span>
<span id="cb339-13"><a href="cfa.html#cb339-13"></a>  <span class="dt">ncol =</span> <span class="dv">2</span></span>
<span id="cb339-14"><a href="cfa.html#cb339-14"></a>)</span>
<span id="cb339-15"><a href="cfa.html#cb339-15"></a></span>
<span id="cb339-16"><a href="cfa.html#cb339-16"></a>disturbances_cor =<span class="st"> </span>result_cor<span class="op">$</span>par[<span class="dv">9</span><span class="op">:</span><span class="dv">16</span>]</span></code></pre></div>
</div>
</div>
<div id="comparison-20" class="section level2">
<h2>Comparison</h2>
<p>Gather results for summary</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="cfa.html#cb340-1"></a>results =<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb340-2"><a href="cfa.html#cb340-2"></a>  <span class="dt">raw =</span> <span class="kw">list</span>(</span>
<span id="cb340-3"><a href="cfa.html#cb340-3"></a>    <span class="dt">loadings =</span> <span class="kw">round</span>(<span class="kw">data.frame</span>(loadings_cov, <span class="dt">Variances =</span> disturbances_cov), <span class="dv">3</span>),</span>
<span id="cb340-4"><a href="cfa.html#cb340-4"></a>    <span class="dt">cov.fact =</span> <span class="kw">round</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(result_cov<span class="op">$</span>par[<span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">17</span>)]), <span class="dt">ncol =</span><span class="dv">2</span>) , <span class="dv">3</span>)</span>
<span id="cb340-5"><a href="cfa.html#cb340-5"></a>  ),</span>
<span id="cb340-6"><a href="cfa.html#cb340-6"></a>  </span>
<span id="cb340-7"><a href="cfa.html#cb340-7"></a>  <span class="dt">standardized =</span> <span class="kw">list</span>(</span>
<span id="cb340-8"><a href="cfa.html#cb340-8"></a>    <span class="dt">loadings =</span> <span class="kw">round</span>(</span>
<span id="cb340-9"><a href="cfa.html#cb340-9"></a>      <span class="kw">data.frame</span>(</span>
<span id="cb340-10"><a href="cfa.html#cb340-10"></a>        loadings_cor,</span>
<span id="cb340-11"><a href="cfa.html#cb340-11"></a>        <span class="dt">Variances =</span> disturbances_cor,</span>
<span id="cb340-12"><a href="cfa.html#cb340-12"></a>        <span class="dt">Rsq =</span> (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>disturbances_cor)</span>
<span id="cb340-13"><a href="cfa.html#cb340-13"></a>      ), <span class="dv">3</span>),</span>
<span id="cb340-14"><a href="cfa.html#cb340-14"></a>    <span class="dt">cor.fact =</span> <span class="kw">round</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, result_cor<span class="op">$</span>par[<span class="kw">c</span>(<span class="dv">17</span>, <span class="dv">17</span>)], <span class="dv">1</span>), <span class="dt">ncol =</span> <span class="dv">2</span>), <span class="dv">3</span>)</span>
<span id="cb340-15"><a href="cfa.html#cb340-15"></a>  ),</span>
<span id="cb340-16"><a href="cfa.html#cb340-16"></a>  </span>
<span id="cb340-17"><a href="cfa.html#cb340-17"></a>  <span class="co"># note inclusion of intercepts for total number of par</span></span>
<span id="cb340-18"><a href="cfa.html#cb340-18"></a>  <span class="dt">fit =</span> <span class="kw">data.frame</span>(</span>
<span id="cb340-19"><a href="cfa.html#cb340-19"></a>    <span class="dt">ll  =</span> result_cov<span class="op">$</span>value,</span>
<span id="cb340-20"><a href="cfa.html#cb340-20"></a>    <span class="dt">AIC =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>result_cov<span class="op">$</span>value <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(par_init_cov) <span class="op">+</span><span class="st"> </span><span class="kw">ncol</span>(y)),</span>
<span id="cb340-21"><a href="cfa.html#cb340-21"></a>    <span class="dt">BIC =</span> <span class="dv">-2</span> <span class="op">*</span><span class="st"> </span>result_cov<span class="op">$</span>value <span class="op">+</span><span class="st"> </span><span class="kw">log</span>(<span class="kw">nrow</span>(y)) <span class="op">*</span><span class="st"> </span>(<span class="kw">length</span>(par_init_cov) <span class="op">+</span><span class="st"> </span><span class="kw">ncol</span>(y))</span>
<span id="cb340-22"><a href="cfa.html#cb340-22"></a>  )  </span>
<span id="cb340-23"><a href="cfa.html#cb340-23"></a>)</span>
<span id="cb340-24"><a href="cfa.html#cb340-24"></a></span>
<span id="cb340-25"><a href="cfa.html#cb340-25"></a>results</span></code></pre></div>
<pre><code>$raw
$raw$loadings
     f1    f2 Variances
1 1.000 0.000     1.097
2 0.465 0.000     0.955
3 0.353 0.000     0.951
4 0.588 0.000     0.948
5 0.000 1.000     1.064
6 0.000 0.744     0.942
7 0.000 0.381     0.976
8 0.000 0.507     1.038

$raw$cov.fact
      [,1]  [,2]
[1,] 0.983 0.170
[2,] 0.170 0.973


$standardized
$standardized$loadings
     X1    X2 Variances   Rsq
1 0.687 0.000     0.528 0.472
2 0.426 0.000     0.818 0.182
3 0.338 0.000     0.886 0.114
4 0.514 0.000     0.736 0.264
5 0.000 0.691     0.522 0.478
6 0.000 0.603     0.636 0.364
7 0.000 0.356     0.874 0.126
8 0.000 0.441     0.806 0.194

$standardized$cor.fact
      [,1]  [,2]
[1,] 1.000 0.174
[2,] 0.174 1.000


$fit
         ll      AIC      BIC
1 -12330.93 24711.86 24834.56</code></pre>
<p>Confirm with <span class="pack" style="">lavaan</span>.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="cfa.html#cb342-1"></a><span class="kw">library</span>(lavaan)</span>
<span id="cb342-2"><a href="cfa.html#cb342-2"></a>y =<span class="st"> </span><span class="kw">data.frame</span>(y)</span>
<span id="cb342-3"><a href="cfa.html#cb342-3"></a>model =<span class="st"> &#39; F1  =~ X1 + X2 + X3 + X4</span></span>
<span id="cb342-4"><a href="cfa.html#cb342-4"></a><span class="st">           F2  =~ X5 + X6 + X7 + X8 &#39;</span></span>
<span id="cb342-5"><a href="cfa.html#cb342-5"></a></span>
<span id="cb342-6"><a href="cfa.html#cb342-6"></a>fit =<span class="st"> </span><span class="kw">cfa</span>(model, <span class="dt">data=</span>y, <span class="dt">mimic=</span><span class="st">&#39;Mplus&#39;</span>, <span class="dt">estimator=</span><span class="st">&#39;ML&#39;</span>)</span>
<span id="cb342-7"><a href="cfa.html#cb342-7"></a>fit.std =<span class="st"> </span><span class="kw">cfa</span>(model, <span class="dt">data=</span>y, <span class="dt">mimic=</span><span class="st">&#39;Mplus&#39;</span>, <span class="dt">estimator=</span><span class="st">&#39;ML&#39;</span>, <span class="dt">std.lv=</span>T, <span class="dt">std.ov=</span>T) <span class="co"># for standardized</span></span>
<span id="cb342-8"><a href="cfa.html#cb342-8"></a></span>
<span id="cb342-9"><a href="cfa.html#cb342-9"></a><span class="co"># note that lavaan does not count the intercepts among the free params for AIC/BIC </span></span>
<span id="cb342-10"><a href="cfa.html#cb342-10"></a><span class="co"># by default, but the mimic=&#39;Mplus&#39; should have them correspond to optim&#39;s results</span></span>
<span id="cb342-11"><a href="cfa.html#cb342-11"></a><span class="kw">summary</span>(fit, <span class="dt">fit.measures=</span><span class="ot">TRUE</span>, <span class="dt">standardized=</span>T)   </span></code></pre></div>
<pre><code>lavaan 0.6-7 ended normally after 30 iterations

  Estimator                                         ML
  Optimization method                           NLMINB
  Number of free parameters                         25
                                                      
  Number of observations                          1000
  Number of missing patterns                         1
                                                      
Model Test User Model:
                                                      
  Test statistic                                25.437
  Degrees of freedom                                19
  P-value (Chi-square)                           0.147

Model Test Baseline Model:

  Test statistic                               746.093
  Degrees of freedom                                28
  P-value                                        0.000

User Model versus Baseline Model:

  Comparative Fit Index (CFI)                    0.991
  Tucker-Lewis Index (TLI)                       0.987

Loglikelihood and Information Criteria:

  Loglikelihood user model (H0)             -12330.931
  Loglikelihood unrestricted model (H1)     -12318.212
                                                      
  Akaike (AIC)                               24711.862
  Bayesian (BIC)                             24834.555
  Sample-size adjusted Bayesian (BIC)        24755.154

Root Mean Square Error of Approximation:

  RMSEA                                          0.018
  90 Percent confidence interval - lower         0.000
  90 Percent confidence interval - upper         0.035
  P-value RMSEA &lt;= 0.05                          1.000

Standardized Root Mean Square Residual:

  SRMR                                           0.019

Parameter Estimates:

  Standard errors                             Standard
  Information                                 Observed
  Observed information based on                Hessian

Latent Variables:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
  F1 =~                                                                 
    X1                1.000                               0.991    0.687
    X2                0.465    0.058    7.955    0.000    0.461    0.427
    X3                0.353    0.050    7.041    0.000    0.350    0.338
    X4                0.588    0.070    8.387    0.000    0.583    0.514
  F2 =~                                                                 
    X5                1.000                               0.986    0.691
    X6                0.744    0.074   10.075    0.000    0.734    0.603
    X7                0.381    0.047    8.160    0.000    0.376    0.356
    X8                0.507    0.055    9.144    0.000    0.500    0.441

Covariances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
  F1 ~~                                                                 
    F2                0.170    0.050    3.367    0.001    0.174    0.174

Intercepts:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .X1                0.054    0.046    1.173    0.241    0.054    0.037
   .X2               -0.004    0.034   -0.104    0.917   -0.004   -0.003
   .X3               -0.012    0.033   -0.372    0.710   -0.012   -0.012
   .X4                0.004    0.036    0.113    0.910    0.004    0.004
   .X5                0.044    0.045    0.964    0.335    0.044    0.031
   .X6               -0.019    0.038   -0.504    0.614   -0.019   -0.016
   .X7                0.019    0.033    0.555    0.579    0.019    0.018
   .X8                0.002    0.036    0.042    0.967    0.002    0.001
    F1                0.000                               0.000    0.000
    F2                0.000                               0.000    0.000

Variances:
                   Estimate  Std.Err  z-value  P(&gt;|z|)   Std.lv  Std.all
   .X1                1.097    0.120    9.119    0.000    1.097    0.527
   .X2                0.955    0.051   18.876    0.000    0.955    0.818
   .X3                0.951    0.046   20.471    0.000    0.951    0.886
   .X4                0.948    0.058   16.263    0.000    0.948    0.736
   .X5                1.064    0.102   10.404    0.000    1.064    0.522
   .X6                0.942    0.066   14.236    0.000    0.942    0.636
   .X7                0.976    0.047   20.607    0.000    0.976    0.874
   .X8                1.038    0.054   19.281    0.000    1.038    0.806
    F1                0.983    0.135    7.264    0.000    1.000    1.000
    F2                0.973    0.119    8.156    0.000    1.000    1.000</code></pre>
<div id="mplus" class="section level3">
<h3>Mplus</h3>
<p>If you have access to Mplus you can use Mplus Automation to prepare the data. The following code is in Mplus syntax and will produce the above model.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="cfa.html#cb344-1"></a><span class="kw">library</span>(MplusAutomation)</span>
<span id="cb344-2"><a href="cfa.html#cb344-2"></a></span>
<span id="cb344-3"><a href="cfa.html#cb344-3"></a><span class="kw">prepareMplusData</span>(<span class="kw">data.frame</span>(y), <span class="st">&quot;factsim.dat&quot;</span>)</span></code></pre></div>
<pre><code>MODEL:
 F1 BY X1-X4;
 F2 BY X5-X8;

results:
 STDYX;</code></pre>
</div>
</div>
<div id="source-19" class="section level2">
<h2>Source</h2>
<p>Source code found at
<a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/cfa.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/cfa.R</a></p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="cox.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="penalized-maximum-likelihood.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "facebook", "linkedin", "google", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/m-clark/models-by-example/blob/master/cfa.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"df_print": "kable",
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
