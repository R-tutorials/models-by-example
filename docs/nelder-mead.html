<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Nelder Mead | Model Estimation by Example</title>
  <meta name="description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Nelder Mead | Model Estimation by Example" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://m-clark.github.io/models-by-example/" />
  <meta property="og:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />
  <meta property="og:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="github-repo" content="m-clark/models-by-example/" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Nelder Mead | Model Estimation by Example" />
  
  <meta name="twitter:description" content="This document provides ‘by-hand’ demonstrations of various models and algorithms. The goal is to take away some of the mystery by providing clean code examples that are easy to run and compare with other tools." />
  <meta name="twitter:image" content="https://m-clark.github.io/models-by-example/img/nineteeneightyR.png" />



<meta name="date" content="2020-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="img/R.ico" type="image/x-icon" />
<link rel="prev" href="newton-irls.html"/>
<link rel="next" href="gradient-descent.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="css/book.css" type="text/css" />
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class='before'><a href="./">Model Estimation by Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="part"><span><b>Models</b></span></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i>Standard Linear Regression</a>
<ul>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#data-setup"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#estimation"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#comparison"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="linear-regression.html"><a href="linear-regression.html#source"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i>Standard Logistic</a>
<ul>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#data-setup-1"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#functions-1"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#estimation-1"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#comparison-1"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="logistic-regression.html"><a href="logistic-regression.html#source-1"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html"><i class="fa fa-check"></i>One-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#main-function"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#data-setup-2"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#estimation-2"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#comparison-2"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-one-factor.html"><a href="mixed-model-one-factor.html#source-2"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html"><i class="fa fa-check"></i>Two-factor Mixed Model</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#main-function-1"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#data-setup-3"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#estimation-3"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#comparison-3"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="mixed-model-two-factor.html"><a href="mixed-model-two-factor.html#source-3"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html"><i class="fa fa-check"></i>Mixed Model via ML</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#introduction-1"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#maximum-likelihood-estimation"><i class="fa fa-check"></i>Maximum Likelihood Estimation</a>
<ul>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#main-function-2"><i class="fa fa-check"></i>Main Function</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#results"><i class="fa fa-check"></i>Results</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#issues-with-ml-estimation"><i class="fa fa-check"></i>Issues with ML estimation</a></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#link-with-penalized-regression"><i class="fa fa-check"></i>Link with penalized regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="mixed-model-ML.html"><a href="mixed-model-ML.html#source-4"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html"><i class="fa fa-check"></i>Probit &amp; Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#standard-probit"><i class="fa fa-check"></i>Standard Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#examples"><i class="fa fa-check"></i>Examples</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#bivariate-probit"><i class="fa fa-check"></i>Bivariate Probit</a>
<ul>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#example"><i class="fa fa-check"></i>Example</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="probit.html"><a href="probit.html#source-5"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html"><i class="fa fa-check"></i>Heckman Selection</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#data-setup-4"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#two-step-approach"><i class="fa fa-check"></i>Two step approach</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-1-probit-model"><i class="fa fa-check"></i>Step 1: Probit Model</a></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#step-2-estimate-via-linear-regression"><i class="fa fa-check"></i>Step 2: Estimate via Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#maximum-likelihood"><i class="fa fa-check"></i>Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#comparison-4"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="heckman-selection.html"><a href="heckman-selection.html#source-6"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html"><i class="fa fa-check"></i>Marginal Structural Models</a>
<ul>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#data-setup-5"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#create-the-weights"><i class="fa fa-check"></i>Create the Weights</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#estimation-4"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#comparison-5"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="marginal-structural.html"><a href="marginal-structural.html#source-7"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html"><i class="fa fa-check"></i>Tobit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-an-upper-limit"><i class="fa fa-check"></i>Demonstrate Censoring with an Upper Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#data-setup-6"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-6"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#demonstrate-censoring-with-a-lower-limit"><i class="fa fa-check"></i>Demonstrate censoring with a Lower Limit</a>
<ul>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#comparison-7"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tobit.html"><a href="tobit.html#source-8"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html"><i class="fa fa-check"></i>Naive Bayes</a>
<ul>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#initialization"><i class="fa fa-check"></i>Initialization</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#comparison-8"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="naive-bayes.html"><a href="naive-bayes.html#source-9"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html"><i class="fa fa-check"></i>Multinomial</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#standard-categorical-model"><i class="fa fa-check"></i>Standard (Categorical) Model</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#data-setup-7"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#multinomial-via-maximum-likelihood"><i class="fa fa-check"></i>Multinomial via Maximum Likelihood</a></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-9"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#alternative-specific-and-constant-variables"><i class="fa fa-check"></i>Alternative specific and constant variables</a>
<ul>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#comparison-10"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="multinomial.html"><a href="multinomial.html#source-10"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html"><i class="fa fa-check"></i>Ordinal</a>
<ul>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#data-1"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#estimation-5"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#comparison-11"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ordinal.html"><a href="ordinal.html#source-11"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html"><i class="fa fa-check"></i>Quantile Regression</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#loss-function"><i class="fa fa-check"></i>Loss function</a>
<ul>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#data-prep"><i class="fa fa-check"></i>Data Prep</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#median-estimation"><i class="fa fa-check"></i>Median estimation</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#other-quantiles"><i class="fa fa-check"></i>Other quantiles</a></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#visualize"><i class="fa fa-check"></i>Visualize</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="quantile-regression.html"><a href="quantile-regression.html#source-12"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html"><i class="fa fa-check"></i>Cubic Spline Model</a>
<ul>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#data-setup-8"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#functions-2"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-1"><i class="fa fa-check"></i>Example 1</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#example-2"><i class="fa fa-check"></i>Example 2</a></li>
<li class="chapter" data-level="" data-path="cubic-spline.html"><a href="cubic-spline.html#source-13"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Algorithms</b></span></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html"><i class="fa fa-check"></i>Penalized Maximum Likelihood</a>
<ul>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#data-setup-9"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#functions-3"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#estimation-6"><i class="fa fa-check"></i>Estimation</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#comparison-12"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="penalized-maximum-likelihood.html"><a href="penalized-maximum-likelihood.html#source-14"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i>L1 (lasso) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#functions-4"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#data-setup-10"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#comparison-13"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="lasso.html"><a href="lasso.html#source-15"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html"><i class="fa fa-check"></i>L2 (ridge) regularization</a>
<ul>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#comparison-14"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="ridge.html"><a href="ridge.html#source-16"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html"><i class="fa fa-check"></i>Newton and IRLS</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#data-setup-11"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#functions-5"><i class="fa fa-check"></i>Functions</a>
<ul>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#newtons-method"><i class="fa fa-check"></i>Newton’s Method</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#irls"><i class="fa fa-check"></i>IRLS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#comparison-15"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="newton-irls.html"><a href="newton-irls.html#source-17"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html"><i class="fa fa-check"></i>Nelder Mead</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#first-version"><i class="fa fa-check"></i>First Version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-3"><i class="fa fa-check"></i>Example</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model"><i class="fa fa-check"></i>A Regression Model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#second-version"><i class="fa fa-check"></i>Second Version</a>
<ul>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#example-function"><i class="fa fa-check"></i>Example Function</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#a-regression-model-1"><i class="fa fa-check"></i>A Regression Model</a></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#comparison-17"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="nelder-mead.html"><a href="nelder-mead.html#source-18"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html"><i class="fa fa-check"></i>Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#data-setup-13"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#gradient-descent-algorithm"><i class="fa fa-check"></i>Gradient Descent Algorithm</a>
<ul>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#run"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#comparison-18"><i class="fa fa-check"></i>Comparison</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="gradient-descent.html"><a href="gradient-descent.html#source-19"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html"><i class="fa fa-check"></i>Stochastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-setup-14"><i class="fa fa-check"></i>Data Setup</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#main-function-3"><i class="fa fa-check"></i>Main Function</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-1"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-19"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#data-set-shift"><i class="fa fa-check"></i>Data Set Shift</a>
<ul>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#run-2"><i class="fa fa-check"></i>Run</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#comparison-20"><i class="fa fa-check"></i>Comparison</a></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#visualize-estimates-1"><i class="fa fa-check"></i>Visualize Estimates</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="stochastic-gradient-descent.html"><a href="stochastic-gradient-descent.html#source-20"><i class="fa fa-check"></i>Source</a></li>
</ul></li>
<li class="part"><span><b>Other</b></span></li>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html"><i class="fa fa-check"></i>Supplemental</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#other-languages"><i class="fa fa-check"></i>Other Languages</a>
<ul>
<li class="chapter" data-level="" data-path="supplemental.html"><a href="supplemental.html#algorithms"><i class="fa fa-check"></i>Algorithms</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li class='after'">
   <a href="https://m-clark.github.io/">
      <img src="img/mc_logo.png" style="width:25%; padding:0px 0; display:block; margin: 0 auto;" alt="MC logo">
   </a>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a href="https://github.com/m-clark/">
         <i class="fab fa-github fa-2x" aria-hidden="true"></i>
      </a>
   </div>
</li>
<li class='after'">
   <div style='text-align:center'>
      <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
         <i class="fab fa-creative-commons fa-lg"></i>
         <i class="fab fa-creative-commons-by fa-lg"></i>
         <i class="fab fa-creative-commons-sa fa-lg"></i>
      </a>
   </div>
</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Model Estimation by Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nelder-mead" class="section level1">
<h1>Nelder Mead</h1>
<p>This is based on the pure Python implementation by François Chollet found at
<a href="https://github.com/fchollet/nelder-mead" class="uri">https://github.com/fchollet/nelder-mead</a> (also in the Miscellaneous R code repo at
nelder_mead.py). This is mostly just an academic exercise on my part. I’m
not sure how much one would use the basic NM for many situations. In my
experience BFGS and other approaches would be faster, more accurate, and less
sensitive to starting values for the types of problems I’ve played around
with. Others who actually spend their time researching such things seem to
agree.</p>
<p>There were two issues on
(GitHub)[<a href="https://github.com/fchollet/nelder-mead/issues/2" class="uri">https://github.com/fchollet/nelder-mead/issues/2</a>] regarding the
original code, and I’ve implemented the suggested corrections with notes. The
initial function code is not very R-like, as the goal was to keep more
similar to the original Python for comparison, which used a list approach. I
also provide a more R-like/cleaner version that uses matrices instead of
lists, but which still sticks the same approach for the most part.</p>
<p>For both functions, comparisons are made using the <code>optimx</code> package, but feel
free to use base R’s <code>optim</code> instead.</p>
<ul>
<li><code>f</code> function to optimize, must return a scalar score and operate over
an array of the same dimensions as x_start</li>
<li><code>x_start</code> initial position</li>
<li><code>step</code> look-around radius in initial step</li>
<li><code>no_improve_thr</code> See no_improv_break</li>
<li><code>no_improv_break</code> break after no_improv_break iterations with an
improvement lower than no_improv_thr</li>
<li><code>max_iter</code> always break after this number of iterations. Set it to 0 to
loop indefinitely.</li>
<li><code>alpha</code> parameters of the algorithm (see Wikipedia page for reference)</li>
<li><code>gamma</code> parameters of the algorithm (see Wikipedia page for reference)</li>
<li><code>rho</code> parameters of the algorithm (see Wikipedia page for reference)</li>
<li><code>sigma</code> parameters of the algorithm (see Wikipedia page for reference)</li>
<li><code>verbose</code> Print iterations?</li>
</ul>
<p>This function returns the best parameter array and best score.</p>
<div id="first-version" class="section level2">
<h2>First Version</h2>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="nelder-mead.html#cb250-1"></a>nelder_mead =<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb250-2"><a href="nelder-mead.html#cb250-2"></a>  f, </span>
<span id="cb250-3"><a href="nelder-mead.html#cb250-3"></a>  x_start,</span>
<span id="cb250-4"><a href="nelder-mead.html#cb250-4"></a>  <span class="dt">step =</span> <span class="fl">0.1</span>,</span>
<span id="cb250-5"><a href="nelder-mead.html#cb250-5"></a>  <span class="dt">no_improve_thr  =</span> <span class="fl">1e-12</span>,</span>
<span id="cb250-6"><a href="nelder-mead.html#cb250-6"></a>  <span class="dt">no_improv_break =</span> <span class="dv">10</span>,</span>
<span id="cb250-7"><a href="nelder-mead.html#cb250-7"></a>  <span class="dt">max_iter =</span> <span class="dv">0</span>,</span>
<span id="cb250-8"><a href="nelder-mead.html#cb250-8"></a>  <span class="dt">alpha    =</span> <span class="dv">1</span>,</span>
<span id="cb250-9"><a href="nelder-mead.html#cb250-9"></a>  <span class="dt">gamma    =</span> <span class="dv">2</span>,</span>
<span id="cb250-10"><a href="nelder-mead.html#cb250-10"></a>  <span class="dt">rho      =</span> <span class="fl">0.5</span>,</span>
<span id="cb250-11"><a href="nelder-mead.html#cb250-11"></a>  <span class="dt">sigma    =</span> <span class="fl">0.5</span>,</span>
<span id="cb250-12"><a href="nelder-mead.html#cb250-12"></a>  <span class="dt">verbose  =</span> <span class="ot">FALSE</span></span>
<span id="cb250-13"><a href="nelder-mead.html#cb250-13"></a>  ) {</span>
<span id="cb250-14"><a href="nelder-mead.html#cb250-14"></a>  <span class="co"># init</span></span>
<span id="cb250-15"><a href="nelder-mead.html#cb250-15"></a>  dim =<span class="st"> </span><span class="kw">length</span>(x_start)</span>
<span id="cb250-16"><a href="nelder-mead.html#cb250-16"></a>  prev_best =<span class="st"> </span><span class="kw">f</span>(x_start)</span>
<span id="cb250-17"><a href="nelder-mead.html#cb250-17"></a>  no_improv =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb250-18"><a href="nelder-mead.html#cb250-18"></a>  res =<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">x_start =</span> x_start, <span class="dt">prev_best =</span> prev_best))</span>
<span id="cb250-19"><a href="nelder-mead.html#cb250-19"></a>  </span>
<span id="cb250-20"><a href="nelder-mead.html#cb250-20"></a>  </span>
<span id="cb250-21"><a href="nelder-mead.html#cb250-21"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>dim) {</span>
<span id="cb250-22"><a href="nelder-mead.html#cb250-22"></a>    x =<span class="st"> </span>x_start</span>
<span id="cb250-23"><a href="nelder-mead.html#cb250-23"></a>    x[i]  =<span class="st"> </span>x[i] <span class="op">+</span><span class="st"> </span>step</span>
<span id="cb250-24"><a href="nelder-mead.html#cb250-24"></a>    score =<span class="st"> </span><span class="kw">f</span>(x)</span>
<span id="cb250-25"><a href="nelder-mead.html#cb250-25"></a>    res =<span class="st"> </span><span class="kw">append</span>(res, <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">x_start =</span> x, <span class="dt">prev_best =</span> score)))</span>
<span id="cb250-26"><a href="nelder-mead.html#cb250-26"></a>  }</span>
<span id="cb250-27"><a href="nelder-mead.html#cb250-27"></a>  </span>
<span id="cb250-28"><a href="nelder-mead.html#cb250-28"></a>  <span class="co"># simplex iter</span></span>
<span id="cb250-29"><a href="nelder-mead.html#cb250-29"></a>  iters =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb250-30"><a href="nelder-mead.html#cb250-30"></a>  </span>
<span id="cb250-31"><a href="nelder-mead.html#cb250-31"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb250-32"><a href="nelder-mead.html#cb250-32"></a>    <span class="co"># order</span></span>
<span id="cb250-33"><a href="nelder-mead.html#cb250-33"></a>    idx  =<span class="st"> </span><span class="kw">sapply</span>(res, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="dv">2</span>)</span>
<span id="cb250-34"><a href="nelder-mead.html#cb250-34"></a>    res  =<span class="st"> </span>res[<span class="kw">order</span>(idx)]   <span class="co"># ascending order</span></span>
<span id="cb250-35"><a href="nelder-mead.html#cb250-35"></a>    best =<span class="st"> </span>res[[<span class="dv">1</span>]][[<span class="dv">2</span>]]</span>
<span id="cb250-36"><a href="nelder-mead.html#cb250-36"></a>    </span>
<span id="cb250-37"><a href="nelder-mead.html#cb250-37"></a>    <span class="co"># break after max_iter</span></span>
<span id="cb250-38"><a href="nelder-mead.html#cb250-38"></a>    <span class="cf">if</span> (max_iter <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>iters <span class="op">&gt;=</span><span class="st"> </span>max_iter) <span class="kw">return</span>(res[[<span class="dv">1</span>]])</span>
<span id="cb250-39"><a href="nelder-mead.html#cb250-39"></a>    iters =<span class="st"> </span>iters <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb250-40"><a href="nelder-mead.html#cb250-40"></a>    </span>
<span id="cb250-41"><a href="nelder-mead.html#cb250-41"></a>    <span class="co"># break after no_improv_break iterations with no improvement</span></span>
<span id="cb250-42"><a href="nelder-mead.html#cb250-42"></a>    <span class="cf">if</span> (verbose) <span class="kw">message</span>(<span class="kw">paste</span>(<span class="st">&#39;...best so far:&#39;</span>, best))</span>
<span id="cb250-43"><a href="nelder-mead.html#cb250-43"></a>    </span>
<span id="cb250-44"><a href="nelder-mead.html#cb250-44"></a>    <span class="cf">if</span> (best <span class="op">&lt;</span><span class="st"> </span>(prev_best <span class="op">-</span><span class="st"> </span>no_improve_thr)) {</span>
<span id="cb250-45"><a href="nelder-mead.html#cb250-45"></a>      no_improv =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb250-46"><a href="nelder-mead.html#cb250-46"></a>      prev_best =<span class="st"> </span>best</span>
<span id="cb250-47"><a href="nelder-mead.html#cb250-47"></a>    } <span class="cf">else</span> {</span>
<span id="cb250-48"><a href="nelder-mead.html#cb250-48"></a>      no_improv =<span class="st"> </span>no_improv <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb250-49"><a href="nelder-mead.html#cb250-49"></a>    }</span>
<span id="cb250-50"><a href="nelder-mead.html#cb250-50"></a>    </span>
<span id="cb250-51"><a href="nelder-mead.html#cb250-51"></a>    <span class="cf">if</span> (no_improv <span class="op">&gt;=</span><span class="st"> </span>no_improv_break) <span class="kw">return</span>(res[[<span class="dv">1</span>]])</span>
<span id="cb250-52"><a href="nelder-mead.html#cb250-52"></a>    </span>
<span id="cb250-53"><a href="nelder-mead.html#cb250-53"></a>    <span class="co"># centroid</span></span>
<span id="cb250-54"><a href="nelder-mead.html#cb250-54"></a>    x0 =<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, dim)</span>
<span id="cb250-55"><a href="nelder-mead.html#cb250-55"></a>    <span class="cf">for</span> (tup <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>(<span class="kw">length</span>(res)<span class="op">-</span><span class="dv">1</span>)) {</span>
<span id="cb250-56"><a href="nelder-mead.html#cb250-56"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>dim) {</span>
<span id="cb250-57"><a href="nelder-mead.html#cb250-57"></a>        x0[i] =<span class="st"> </span>x0[i] <span class="op">+</span><span class="st"> </span>res[[tup]][[<span class="dv">1</span>]][i] <span class="op">/</span><span class="st"> </span>(<span class="kw">length</span>(res)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb250-58"><a href="nelder-mead.html#cb250-58"></a>      }</span>
<span id="cb250-59"><a href="nelder-mead.html#cb250-59"></a>    }</span>
<span id="cb250-60"><a href="nelder-mead.html#cb250-60"></a>    </span>
<span id="cb250-61"><a href="nelder-mead.html#cb250-61"></a>   <span class="co"># reflection</span></span>
<span id="cb250-62"><a href="nelder-mead.html#cb250-62"></a>   xr =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(x0 <span class="op">-</span><span class="st"> </span>res[[<span class="kw">length</span>(res)]][[<span class="dv">1</span>]])</span>
<span id="cb250-63"><a href="nelder-mead.html#cb250-63"></a>   rscore =<span class="st"> </span><span class="kw">f</span>(xr)</span>
<span id="cb250-64"><a href="nelder-mead.html#cb250-64"></a>   <span class="cf">if</span> (res[[<span class="dv">1</span>]][[<span class="dv">2</span>]] <span class="op">&lt;=</span><span class="st"> </span>rscore <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb250-65"><a href="nelder-mead.html#cb250-65"></a><span class="st">       </span>rscore <span class="op">&lt;</span><span class="st"> </span>res[[<span class="kw">length</span>(res)<span class="op">-</span><span class="dv">1</span>]][[<span class="dv">2</span>]]) {</span>
<span id="cb250-66"><a href="nelder-mead.html#cb250-66"></a>     res[[<span class="kw">length</span>(res)]] =<span class="st"> </span><span class="kw">list</span>(xr, rscore)</span>
<span id="cb250-67"><a href="nelder-mead.html#cb250-67"></a>     <span class="cf">next</span></span>
<span id="cb250-68"><a href="nelder-mead.html#cb250-68"></a>   }</span>
<span id="cb250-69"><a href="nelder-mead.html#cb250-69"></a>     </span>
<span id="cb250-70"><a href="nelder-mead.html#cb250-70"></a>   <span class="co"># expansion</span></span>
<span id="cb250-71"><a href="nelder-mead.html#cb250-71"></a>   <span class="cf">if</span> (rscore <span class="op">&lt;</span><span class="st"> </span>res[[<span class="dv">1</span>]][[<span class="dv">2</span>]]) {</span>
<span id="cb250-72"><a href="nelder-mead.html#cb250-72"></a>     <span class="co"># xe = x0 + gamma*(x0 - res[[length(res)]][[1]])   # issue with this</span></span>
<span id="cb250-73"><a href="nelder-mead.html#cb250-73"></a>     xe =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span>(xr <span class="op">-</span><span class="st"> </span>x0)   </span>
<span id="cb250-74"><a href="nelder-mead.html#cb250-74"></a>     escore =<span class="st"> </span><span class="kw">f</span>(xe)</span>
<span id="cb250-75"><a href="nelder-mead.html#cb250-75"></a>     <span class="cf">if</span> (escore <span class="op">&lt;</span><span class="st"> </span>rscore) {</span>
<span id="cb250-76"><a href="nelder-mead.html#cb250-76"></a>       res[[<span class="kw">length</span>(res)]] =<span class="st"> </span><span class="kw">list</span>(xe, escore)</span>
<span id="cb250-77"><a href="nelder-mead.html#cb250-77"></a>       <span class="cf">next</span></span>
<span id="cb250-78"><a href="nelder-mead.html#cb250-78"></a>     } <span class="cf">else</span> {</span>
<span id="cb250-79"><a href="nelder-mead.html#cb250-79"></a>       res[[<span class="kw">length</span>(res)]] =<span class="st"> </span><span class="kw">list</span>(xr, rscore)</span>
<span id="cb250-80"><a href="nelder-mead.html#cb250-80"></a>       <span class="cf">next</span></span>
<span id="cb250-81"><a href="nelder-mead.html#cb250-81"></a>     }</span>
<span id="cb250-82"><a href="nelder-mead.html#cb250-82"></a>   }</span>
<span id="cb250-83"><a href="nelder-mead.html#cb250-83"></a>   </span>
<span id="cb250-84"><a href="nelder-mead.html#cb250-84"></a>   <span class="co"># contraction</span></span>
<span id="cb250-85"><a href="nelder-mead.html#cb250-85"></a>   <span class="co"># xc = x0 + rho*(x0 - res[[length(res)]][[1]])  # issue with wiki consistency for rho values (and optim)</span></span>
<span id="cb250-86"><a href="nelder-mead.html#cb250-86"></a>   xc =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>rho <span class="op">*</span><span class="st"> </span>(res[[<span class="kw">length</span>(res)]][[<span class="dv">1</span>]] <span class="op">-</span><span class="st"> </span>x0)</span>
<span id="cb250-87"><a href="nelder-mead.html#cb250-87"></a>   cscore =<span class="st"> </span><span class="kw">f</span>(xc)</span>
<span id="cb250-88"><a href="nelder-mead.html#cb250-88"></a>   <span class="cf">if</span> (cscore <span class="op">&lt;</span><span class="st"> </span>res[[<span class="kw">length</span>(res)]][[<span class="dv">2</span>]]) {</span>
<span id="cb250-89"><a href="nelder-mead.html#cb250-89"></a>     res[[<span class="kw">length</span>(res)]] =<span class="st"> </span><span class="kw">list</span>(xc, cscore)</span>
<span id="cb250-90"><a href="nelder-mead.html#cb250-90"></a>     <span class="cf">next</span></span>
<span id="cb250-91"><a href="nelder-mead.html#cb250-91"></a>   }</span>
<span id="cb250-92"><a href="nelder-mead.html#cb250-92"></a>   </span>
<span id="cb250-93"><a href="nelder-mead.html#cb250-93"></a>   <span class="co"># reduction</span></span>
<span id="cb250-94"><a href="nelder-mead.html#cb250-94"></a>   x1   =<span class="st"> </span>res[[<span class="dv">1</span>]][[<span class="dv">1</span>]]</span>
<span id="cb250-95"><a href="nelder-mead.html#cb250-95"></a>   nres =<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb250-96"><a href="nelder-mead.html#cb250-96"></a>   <span class="cf">for</span> (tup <span class="cf">in</span> res) {</span>
<span id="cb250-97"><a href="nelder-mead.html#cb250-97"></a>     redx  =<span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>sigma <span class="op">*</span><span class="st"> </span>(tup[[<span class="dv">1</span>]] <span class="op">-</span><span class="st"> </span>x1)</span>
<span id="cb250-98"><a href="nelder-mead.html#cb250-98"></a>     score =<span class="st"> </span><span class="kw">f</span>(redx)</span>
<span id="cb250-99"><a href="nelder-mead.html#cb250-99"></a>     nres  =<span class="st"> </span><span class="kw">append</span>(nres, <span class="kw">list</span>(<span class="kw">list</span>(redx, score)))</span>
<span id="cb250-100"><a href="nelder-mead.html#cb250-100"></a>   }</span>
<span id="cb250-101"><a href="nelder-mead.html#cb250-101"></a>   </span>
<span id="cb250-102"><a href="nelder-mead.html#cb250-102"></a>   res =<span class="st"> </span>nres</span>
<span id="cb250-103"><a href="nelder-mead.html#cb250-103"></a>  }</span>
<span id="cb250-104"><a href="nelder-mead.html#cb250-104"></a>}</span></code></pre></div>
<div id="example-3" class="section level3">
<h3>Example</h3>
<p>The function to minimize.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="nelder-mead.html#cb251-1"></a>f =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb251-2"><a href="nelder-mead.html#cb251-2"></a>  <span class="kw">sin</span>(x[<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(x[<span class="dv">2</span>]) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="kw">abs</span>(x[<span class="dv">3</span>]) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb251-3"><a href="nelder-mead.html#cb251-3"></a>}</span></code></pre></div>
<p>Estimate.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="nelder-mead.html#cb252-1"></a><span class="kw">nelder_mead</span>(</span>
<span id="cb252-2"><a href="nelder-mead.html#cb252-2"></a>  f, </span>
<span id="cb252-3"><a href="nelder-mead.html#cb252-3"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb252-4"><a href="nelder-mead.html#cb252-4"></a>  <span class="dt">max_iter =</span> <span class="dv">1000</span>, </span>
<span id="cb252-5"><a href="nelder-mead.html#cb252-5"></a>  <span class="dt">no_improve_thr =</span> <span class="fl">1e-12</span></span>
<span id="cb252-6"><a href="nelder-mead.html#cb252-6"></a>)</span></code></pre></div>
<pre><code>[[1]]
[1] -1.570797e+00 -2.235577e-07  1.637460e-14

[[2]]
[1] -1</code></pre>
<p>Compare to <code>optimx</code>. You may see warnings.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="nelder-mead.html#cb254-1"></a>optimx<span class="op">::</span><span class="kw">optimx</span>(</span>
<span id="cb254-2"><a href="nelder-mead.html#cb254-2"></a>  <span class="dt">par =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb254-3"><a href="nelder-mead.html#cb254-3"></a>  <span class="dt">fn =</span> f,</span>
<span id="cb254-4"><a href="nelder-mead.html#cb254-4"></a>  <span class="dt">method =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,</span>
<span id="cb254-5"><a href="nelder-mead.html#cb254-5"></a>  <span class="dt">control =</span> <span class="kw">list</span>(</span>
<span id="cb254-6"><a href="nelder-mead.html#cb254-6"></a>    <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb254-7"><a href="nelder-mead.html#cb254-7"></a>    <span class="dt">gamma =</span> <span class="dv">2</span>,</span>
<span id="cb254-8"><a href="nelder-mead.html#cb254-8"></a>    <span class="dt">beta =</span> <span class="fl">0.5</span>,</span>
<span id="cb254-9"><a href="nelder-mead.html#cb254-9"></a>    <span class="dt">maxit =</span> <span class="dv">1000</span>,</span>
<span id="cb254-10"><a href="nelder-mead.html#cb254-10"></a>    <span class="dt">reltol =</span> <span class="fl">1e-12</span></span>
<span id="cb254-11"><a href="nelder-mead.html#cb254-11"></a>  )</span>
<span id="cb254-12"><a href="nelder-mead.html#cb254-12"></a>)</span></code></pre></div>
<pre><code>                   p1           p2           p3 value fevals gevals niter convcode kkt1 kkt2 xtime
Nelder-Mead -1.570796 1.394018e-08 1.088215e-16    -1    861     NA    NA        0 TRUE TRUE 0.001</code></pre>
</div>
<div id="a-regression-model" class="section level3">
<h3>A Regression Model</h3>
<p>I find a regression model to be more applicable/intuitive for my needs, so
provide an example for that case.</p>
<div id="data-setup-12" class="section level4">
<h4>Data Setup</h4>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="nelder-mead.html#cb256-1"></a><span class="kw">set.seed</span>(<span class="dv">8675309</span>)</span>
<span id="cb256-2"><a href="nelder-mead.html#cb256-2"></a></span>
<span id="cb256-3"><a href="nelder-mead.html#cb256-3"></a>N =<span class="st"> </span><span class="dv">500</span></span>
<span id="cb256-4"><a href="nelder-mead.html#cb256-4"></a>npreds =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb256-5"><a href="nelder-mead.html#cb256-5"></a>X =<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span>, <span class="kw">matrix</span>(<span class="kw">rnorm</span>(N <span class="op">*</span><span class="st"> </span>npreds), <span class="dt">ncol =</span> npreds))</span>
<span id="cb256-6"><a href="nelder-mead.html#cb256-6"></a>beta =<span class="st"> </span><span class="kw">runif</span>(<span class="kw">ncol</span>(X), <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb256-7"><a href="nelder-mead.html#cb256-7"></a>y =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(X))</span></code></pre></div>
<p>Least squares loss function to minimize.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="nelder-mead.html#cb257-1"></a>f =<span class="st"> </span><span class="cf">function</span>(b) {</span>
<span id="cb257-2"><a href="nelder-mead.html#cb257-2"></a>  <span class="kw">crossprod</span>(y <span class="op">-</span><span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>b)[,<span class="dv">1</span>]  <span class="co"># if using optimx need scalar</span></span>
<span id="cb257-3"><a href="nelder-mead.html#cb257-3"></a>}</span></code></pre></div>
<p><code>lm</code> estimates.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="nelder-mead.html#cb258-1"></a><span class="kw">lm.fit</span>(X, y)<span class="op">$</span>coef</span></code></pre></div>
<pre><code>         x1          x2          x3          x4          x5          x6 
-0.96214657  0.59432481  0.04864576  0.27573466  0.97525840 -0.07470287 </code></pre>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="nelder-mead.html#cb260-1"></a>nm_result =<span class="st"> </span><span class="kw">nelder_mead</span>(</span>
<span id="cb260-2"><a href="nelder-mead.html#cb260-2"></a>  f, </span>
<span id="cb260-3"><a href="nelder-mead.html#cb260-3"></a>  <span class="kw">runif</span>(<span class="kw">ncol</span>(X)), </span>
<span id="cb260-4"><a href="nelder-mead.html#cb260-4"></a>  <span class="dt">max_iter =</span> <span class="dv">2000</span>,</span>
<span id="cb260-5"><a href="nelder-mead.html#cb260-5"></a>  <span class="dt">no_improve_thr =</span> <span class="fl">1e-12</span>,</span>
<span id="cb260-6"><a href="nelder-mead.html#cb260-6"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb260-7"><a href="nelder-mead.html#cb260-7"></a>)</span></code></pre></div>
</div>
<div id="comparison-16" class="section level4">
<h4>Comparison</h4>
<p>Compare to <code>optimx</code>.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="nelder-mead.html#cb261-1"></a>opt_out =<span class="st"> </span>optimx<span class="op">::</span><span class="kw">optimx</span>(</span>
<span id="cb261-2"><a href="nelder-mead.html#cb261-2"></a>  <span class="kw">runif</span>(<span class="kw">ncol</span>(X)),</span>
<span id="cb261-3"><a href="nelder-mead.html#cb261-3"></a>  <span class="dt">fn =</span> f,  <span class="co"># model function</span></span>
<span id="cb261-4"><a href="nelder-mead.html#cb261-4"></a>  <span class="dt">method  =</span> <span class="st">&#39;Nelder-Mead&#39;</span>,</span>
<span id="cb261-5"><a href="nelder-mead.html#cb261-5"></a>  <span class="dt">control =</span> <span class="kw">list</span>(</span>
<span id="cb261-6"><a href="nelder-mead.html#cb261-6"></a>    <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb261-7"><a href="nelder-mead.html#cb261-7"></a>    <span class="dt">gamma =</span> <span class="dv">2</span>,</span>
<span id="cb261-8"><a href="nelder-mead.html#cb261-8"></a>    <span class="dt">beta  =</span> <span class="fl">0.5</span>,</span>
<span id="cb261-9"><a href="nelder-mead.html#cb261-9"></a>    <span class="co">#rho</span></span>
<span id="cb261-10"><a href="nelder-mead.html#cb261-10"></a>    <span class="dt">maxit  =</span> <span class="dv">2000</span>,</span>
<span id="cb261-11"><a href="nelder-mead.html#cb261-11"></a>    <span class="dt">reltol =</span> <span class="fl">1e-12</span></span>
<span id="cb261-12"><a href="nelder-mead.html#cb261-12"></a>  )</span>
<span id="cb261-13"><a href="nelder-mead.html#cb261-13"></a>)</span>
<span id="cb261-14"><a href="nelder-mead.html#cb261-14"></a></span>
<span id="cb261-15"><a href="nelder-mead.html#cb261-15"></a><span class="kw">rbind</span>(</span>
<span id="cb261-16"><a href="nelder-mead.html#cb261-16"></a>  <span class="dt">nm_func =</span> <span class="kw">unlist</span>(nm_result),</span>
<span id="cb261-17"><a href="nelder-mead.html#cb261-17"></a>  <span class="dt">nm_optimx =</span> opt_out[<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>]</span>
<span id="cb261-18"><a href="nelder-mead.html#cb261-18"></a>)</span></code></pre></div>
<pre><code>                  p1       p2         p3        p4        p5          p6    value
nm_func   -0.9621510 0.594327 0.04864183 0.2757265 0.9752524 -0.07470389 501.3155
nm_optimx -0.9621494 0.594325 0.04864620 0.2757383 0.9752579 -0.07470054 501.3155</code></pre>
</div>
</div>
</div>
<div id="second-version" class="section level2">
<h2>Second Version</h2>
<p>This is a more natural R approach in my opinion.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="nelder-mead.html#cb263-1"></a>nelder_mead2 =<span class="st"> </span><span class="cf">function</span>(</span>
<span id="cb263-2"><a href="nelder-mead.html#cb263-2"></a>  f,</span>
<span id="cb263-3"><a href="nelder-mead.html#cb263-3"></a>  x_start,</span>
<span id="cb263-4"><a href="nelder-mead.html#cb263-4"></a>  <span class="dt">step =</span> <span class="fl">0.1</span>,</span>
<span id="cb263-5"><a href="nelder-mead.html#cb263-5"></a>  <span class="dt">no_improve_thr  =</span> <span class="fl">1e-12</span>,</span>
<span id="cb263-6"><a href="nelder-mead.html#cb263-6"></a>  <span class="dt">no_improv_break =</span> <span class="dv">10</span>,</span>
<span id="cb263-7"><a href="nelder-mead.html#cb263-7"></a>  <span class="dt">max_iter =</span> <span class="dv">0</span>,</span>
<span id="cb263-8"><a href="nelder-mead.html#cb263-8"></a>  <span class="dt">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb263-9"><a href="nelder-mead.html#cb263-9"></a>  <span class="dt">gamma =</span> <span class="dv">2</span>,</span>
<span id="cb263-10"><a href="nelder-mead.html#cb263-10"></a>  <span class="dt">rho   =</span> <span class="fl">0.5</span>,</span>
<span id="cb263-11"><a href="nelder-mead.html#cb263-11"></a>  <span class="dt">sigma =</span> <span class="fl">0.5</span>,</span>
<span id="cb263-12"><a href="nelder-mead.html#cb263-12"></a>  <span class="dt">verbose =</span> <span class="ot">FALSE</span></span>
<span id="cb263-13"><a href="nelder-mead.html#cb263-13"></a>) {</span>
<span id="cb263-14"><a href="nelder-mead.html#cb263-14"></a>  </span>
<span id="cb263-15"><a href="nelder-mead.html#cb263-15"></a>  <span class="co"># init</span></span>
<span id="cb263-16"><a href="nelder-mead.html#cb263-16"></a>  npar =<span class="st"> </span><span class="kw">length</span>(x_start)</span>
<span id="cb263-17"><a href="nelder-mead.html#cb263-17"></a>  nc =<span class="st"> </span>npar <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb263-18"><a href="nelder-mead.html#cb263-18"></a>  prev_best =<span class="st"> </span><span class="kw">f</span>(x_start)</span>
<span id="cb263-19"><a href="nelder-mead.html#cb263-19"></a>  no_improv =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb263-20"><a href="nelder-mead.html#cb263-20"></a>  res =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(x_start, prev_best), <span class="dt">ncol =</span> nc)</span>
<span id="cb263-21"><a href="nelder-mead.html#cb263-21"></a>  <span class="kw">colnames</span>(res) =<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">&#39;par&#39;</span>, <span class="dv">1</span><span class="op">:</span>npar, <span class="dt">sep =</span> <span class="st">&#39;_&#39;</span>), <span class="st">&#39;score&#39;</span>)</span>
<span id="cb263-22"><a href="nelder-mead.html#cb263-22"></a>  </span>
<span id="cb263-23"><a href="nelder-mead.html#cb263-23"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>npar) {</span>
<span id="cb263-24"><a href="nelder-mead.html#cb263-24"></a>    x     =<span class="st"> </span>x_start</span>
<span id="cb263-25"><a href="nelder-mead.html#cb263-25"></a>    x[i]  =<span class="st"> </span>x[i] <span class="op">+</span><span class="st"> </span>step</span>
<span id="cb263-26"><a href="nelder-mead.html#cb263-26"></a>    score =<span class="st"> </span><span class="kw">f</span>(x)</span>
<span id="cb263-27"><a href="nelder-mead.html#cb263-27"></a>    res   =<span class="st"> </span><span class="kw">rbind</span>(res, <span class="kw">c</span>(x, score))</span>
<span id="cb263-28"><a href="nelder-mead.html#cb263-28"></a>  }</span>
<span id="cb263-29"><a href="nelder-mead.html#cb263-29"></a>  </span>
<span id="cb263-30"><a href="nelder-mead.html#cb263-30"></a>  <span class="co"># simplex iter</span></span>
<span id="cb263-31"><a href="nelder-mead.html#cb263-31"></a>  iters =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb263-32"><a href="nelder-mead.html#cb263-32"></a>  </span>
<span id="cb263-33"><a href="nelder-mead.html#cb263-33"></a>  <span class="cf">while</span> (<span class="ot">TRUE</span>) {</span>
<span id="cb263-34"><a href="nelder-mead.html#cb263-34"></a>    <span class="co"># order</span></span>
<span id="cb263-35"><a href="nelder-mead.html#cb263-35"></a>    res  =<span class="st"> </span>res[<span class="kw">order</span>(res[, nc]), ]   <span class="co"># ascending order</span></span>
<span id="cb263-36"><a href="nelder-mead.html#cb263-36"></a>    best =<span class="st"> </span>res[<span class="dv">1</span>, nc]</span>
<span id="cb263-37"><a href="nelder-mead.html#cb263-37"></a>    </span>
<span id="cb263-38"><a href="nelder-mead.html#cb263-38"></a>    <span class="co"># break after max_iter</span></span>
<span id="cb263-39"><a href="nelder-mead.html#cb263-39"></a>    <span class="cf">if</span> (max_iter <span class="op">&amp;</span><span class="st"> </span>iters <span class="op">&gt;=</span><span class="st"> </span>max_iter) <span class="kw">return</span>(res[<span class="dv">1</span>, ])</span>
<span id="cb263-40"><a href="nelder-mead.html#cb263-40"></a>    iters =<span class="st"> </span>iters <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb263-41"><a href="nelder-mead.html#cb263-41"></a>    </span>
<span id="cb263-42"><a href="nelder-mead.html#cb263-42"></a>    <span class="co"># break after no_improv_break iterations with no improvement</span></span>
<span id="cb263-43"><a href="nelder-mead.html#cb263-43"></a>    <span class="cf">if</span> (verbose) <span class="kw">message</span>(<span class="kw">paste</span>(<span class="st">&#39;...best so far:&#39;</span>, best))</span>
<span id="cb263-44"><a href="nelder-mead.html#cb263-44"></a>    </span>
<span id="cb263-45"><a href="nelder-mead.html#cb263-45"></a>    <span class="cf">if</span> (best <span class="op">&lt;</span><span class="st"> </span>(prev_best <span class="op">-</span><span class="st"> </span>no_improve_thr)) {</span>
<span id="cb263-46"><a href="nelder-mead.html#cb263-46"></a>      no_improv =<span class="st"> </span><span class="dv">0</span></span>
<span id="cb263-47"><a href="nelder-mead.html#cb263-47"></a>      prev_best =<span class="st"> </span>best</span>
<span id="cb263-48"><a href="nelder-mead.html#cb263-48"></a>    } <span class="cf">else</span> {</span>
<span id="cb263-49"><a href="nelder-mead.html#cb263-49"></a>      no_improv =<span class="st"> </span>no_improv <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb263-50"><a href="nelder-mead.html#cb263-50"></a>    }</span>
<span id="cb263-51"><a href="nelder-mead.html#cb263-51"></a>    </span>
<span id="cb263-52"><a href="nelder-mead.html#cb263-52"></a>    <span class="cf">if</span> (no_improv <span class="op">&gt;=</span><span class="st"> </span>no_improv_break)</span>
<span id="cb263-53"><a href="nelder-mead.html#cb263-53"></a>      <span class="kw">return</span>(res[<span class="dv">1</span>, ])</span>
<span id="cb263-54"><a href="nelder-mead.html#cb263-54"></a>    </span>
<span id="cb263-55"><a href="nelder-mead.html#cb263-55"></a>    nr =<span class="st"> </span><span class="kw">nrow</span>(res)</span>
<span id="cb263-56"><a href="nelder-mead.html#cb263-56"></a>    </span>
<span id="cb263-57"><a href="nelder-mead.html#cb263-57"></a>    <span class="co"># centroid: more efficient than previous double loop</span></span>
<span id="cb263-58"><a href="nelder-mead.html#cb263-58"></a>    x0 =<span class="st"> </span><span class="kw">colMeans</span>(res[(<span class="dv">1</span><span class="op">:</span>npar), <span class="op">-</span>nc])</span>
<span id="cb263-59"><a href="nelder-mead.html#cb263-59"></a>    </span>
<span id="cb263-60"><a href="nelder-mead.html#cb263-60"></a>    <span class="co"># reflection</span></span>
<span id="cb263-61"><a href="nelder-mead.html#cb263-61"></a>    xr =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>alpha <span class="op">*</span><span class="st"> </span>(x0 <span class="op">-</span><span class="st"> </span>res[nr, <span class="op">-</span>nc])</span>
<span id="cb263-62"><a href="nelder-mead.html#cb263-62"></a>    </span>
<span id="cb263-63"><a href="nelder-mead.html#cb263-63"></a>    rscore =<span class="st"> </span><span class="kw">f</span>(xr)</span>
<span id="cb263-64"><a href="nelder-mead.html#cb263-64"></a>    </span>
<span id="cb263-65"><a href="nelder-mead.html#cb263-65"></a>    <span class="cf">if</span> (res[<span class="dv">1</span>, <span class="st">&#39;score&#39;</span>] <span class="op">&lt;=</span><span class="st"> </span>rscore <span class="op">&amp;</span><span class="st"> </span>rscore <span class="op">&lt;</span><span class="st"> </span>res[npar, <span class="st">&#39;score&#39;</span>]) {</span>
<span id="cb263-66"><a href="nelder-mead.html#cb263-66"></a>      res[nr,] =<span class="st"> </span><span class="kw">c</span>(xr, rscore)</span>
<span id="cb263-67"><a href="nelder-mead.html#cb263-67"></a>      <span class="cf">next</span></span>
<span id="cb263-68"><a href="nelder-mead.html#cb263-68"></a>    }</span>
<span id="cb263-69"><a href="nelder-mead.html#cb263-69"></a>    </span>
<span id="cb263-70"><a href="nelder-mead.html#cb263-70"></a>    <span class="co"># expansion</span></span>
<span id="cb263-71"><a href="nelder-mead.html#cb263-71"></a>    <span class="cf">if</span> (rscore <span class="op">&lt;</span><span class="st"> </span>res[<span class="dv">1</span>, <span class="st">&#39;score&#39;</span>]) {</span>
<span id="cb263-72"><a href="nelder-mead.html#cb263-72"></a>      xe =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span>(xr <span class="op">-</span><span class="st"> </span>x0)</span>
<span id="cb263-73"><a href="nelder-mead.html#cb263-73"></a>      escore =<span class="st"> </span><span class="kw">f</span>(xe)</span>
<span id="cb263-74"><a href="nelder-mead.html#cb263-74"></a>      <span class="cf">if</span> (escore <span class="op">&lt;</span><span class="st"> </span>rscore) {</span>
<span id="cb263-75"><a href="nelder-mead.html#cb263-75"></a>        res[nr, ] =<span class="st"> </span><span class="kw">c</span>(xe, escore)</span>
<span id="cb263-76"><a href="nelder-mead.html#cb263-76"></a>        <span class="cf">next</span></span>
<span id="cb263-77"><a href="nelder-mead.html#cb263-77"></a>      } <span class="cf">else</span> {</span>
<span id="cb263-78"><a href="nelder-mead.html#cb263-78"></a>        res[nr, ] =<span class="st"> </span><span class="kw">c</span>(xr, rscore)</span>
<span id="cb263-79"><a href="nelder-mead.html#cb263-79"></a>        <span class="cf">next</span></span>
<span id="cb263-80"><a href="nelder-mead.html#cb263-80"></a>      }</span>
<span id="cb263-81"><a href="nelder-mead.html#cb263-81"></a>    }</span>
<span id="cb263-82"><a href="nelder-mead.html#cb263-82"></a>    </span>
<span id="cb263-83"><a href="nelder-mead.html#cb263-83"></a>    <span class="co"># contraction</span></span>
<span id="cb263-84"><a href="nelder-mead.html#cb263-84"></a>    xc =<span class="st"> </span>x0 <span class="op">+</span><span class="st"> </span>rho <span class="op">*</span><span class="st"> </span>(res[nr, <span class="op">-</span>nc] <span class="op">-</span><span class="st"> </span>x0)</span>
<span id="cb263-85"><a href="nelder-mead.html#cb263-85"></a>    </span>
<span id="cb263-86"><a href="nelder-mead.html#cb263-86"></a>    cscore =<span class="st"> </span><span class="kw">f</span>(xc)</span>
<span id="cb263-87"><a href="nelder-mead.html#cb263-87"></a>    </span>
<span id="cb263-88"><a href="nelder-mead.html#cb263-88"></a>    <span class="cf">if</span> (cscore <span class="op">&lt;</span><span class="st"> </span>res[nr, <span class="st">&#39;score&#39;</span>]) {</span>
<span id="cb263-89"><a href="nelder-mead.html#cb263-89"></a>      res[nr,] =<span class="st"> </span><span class="kw">c</span>(xc, cscore)</span>
<span id="cb263-90"><a href="nelder-mead.html#cb263-90"></a>      <span class="cf">next</span></span>
<span id="cb263-91"><a href="nelder-mead.html#cb263-91"></a>    }</span>
<span id="cb263-92"><a href="nelder-mead.html#cb263-92"></a>    </span>
<span id="cb263-93"><a href="nelder-mead.html#cb263-93"></a>    <span class="co"># reduction</span></span>
<span id="cb263-94"><a href="nelder-mead.html#cb263-94"></a>    x1 =<span class="st"> </span>res[<span class="dv">1</span>, <span class="op">-</span>nc]</span>
<span id="cb263-95"><a href="nelder-mead.html#cb263-95"></a>    </span>
<span id="cb263-96"><a href="nelder-mead.html#cb263-96"></a>    nres =<span class="st"> </span>res</span>
<span id="cb263-97"><a href="nelder-mead.html#cb263-97"></a>    </span>
<span id="cb263-98"><a href="nelder-mead.html#cb263-98"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nr) {</span>
<span id="cb263-99"><a href="nelder-mead.html#cb263-99"></a>      redx  =<span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>sigma <span class="op">*</span><span class="st"> </span>(res[i, <span class="op">-</span>nc] <span class="op">-</span><span class="st"> </span>x1)</span>
<span id="cb263-100"><a href="nelder-mead.html#cb263-100"></a>      score =<span class="st"> </span><span class="kw">f</span>(redx)</span>
<span id="cb263-101"><a href="nelder-mead.html#cb263-101"></a>      nres[i, ] =<span class="st"> </span><span class="kw">c</span>(redx, score)</span>
<span id="cb263-102"><a href="nelder-mead.html#cb263-102"></a>    }</span>
<span id="cb263-103"><a href="nelder-mead.html#cb263-103"></a>    </span>
<span id="cb263-104"><a href="nelder-mead.html#cb263-104"></a>    res =<span class="st"> </span>nres</span>
<span id="cb263-105"><a href="nelder-mead.html#cb263-105"></a>  }</span>
<span id="cb263-106"><a href="nelder-mead.html#cb263-106"></a>}</span></code></pre></div>
<div id="example-function" class="section level3">
<h3>Example Function</h3>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="nelder-mead.html#cb264-1"></a>f =<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb264-2"><a href="nelder-mead.html#cb264-2"></a>  <span class="kw">sin</span>(x[<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span><span class="kw">cos</span>(x[<span class="dv">2</span>]) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="kw">abs</span>(x[<span class="dv">3</span>]) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb264-3"><a href="nelder-mead.html#cb264-3"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="nelder-mead.html#cb265-1"></a><span class="kw">nelder_mead2</span>(</span>
<span id="cb265-2"><a href="nelder-mead.html#cb265-2"></a>  f, </span>
<span id="cb265-3"><a href="nelder-mead.html#cb265-3"></a>  <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb265-4"><a href="nelder-mead.html#cb265-4"></a>  <span class="dt">max_iter =</span> <span class="dv">1000</span>, </span>
<span id="cb265-5"><a href="nelder-mead.html#cb265-5"></a>  <span class="dt">no_improve_thr =</span> <span class="fl">1e-12</span></span>
<span id="cb265-6"><a href="nelder-mead.html#cb265-6"></a>)</span></code></pre></div>
<pre><code>        par_1         par_2         par_3         score 
-1.570797e+00 -2.235577e-07  1.622809e-14 -1.000000e+00 </code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="nelder-mead.html#cb267-1"></a>optimx<span class="op">::</span><span class="kw">optimx</span>(</span>
<span id="cb267-2"><a href="nelder-mead.html#cb267-2"></a>  <span class="dt">par =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb267-3"><a href="nelder-mead.html#cb267-3"></a>  <span class="dt">fn =</span> f, </span>
<span id="cb267-4"><a href="nelder-mead.html#cb267-4"></a>  <span class="dt">method   =</span> <span class="st">&quot;Nelder-Mead&quot;</span>,</span>
<span id="cb267-5"><a href="nelder-mead.html#cb267-5"></a>  <span class="dt">control  =</span> <span class="kw">list</span>(</span>
<span id="cb267-6"><a href="nelder-mead.html#cb267-6"></a>    <span class="dt">alpha  =</span> <span class="dv">1</span>,</span>
<span id="cb267-7"><a href="nelder-mead.html#cb267-7"></a>    <span class="dt">gamma  =</span> <span class="dv">2</span>,</span>
<span id="cb267-8"><a href="nelder-mead.html#cb267-8"></a>    <span class="dt">beta   =</span> <span class="fl">0.5</span>,</span>
<span id="cb267-9"><a href="nelder-mead.html#cb267-9"></a>    <span class="dt">maxit  =</span> <span class="dv">1000</span>,</span>
<span id="cb267-10"><a href="nelder-mead.html#cb267-10"></a>    <span class="dt">reltol =</span> <span class="fl">1e-12</span></span>
<span id="cb267-11"><a href="nelder-mead.html#cb267-11"></a>  )</span>
<span id="cb267-12"><a href="nelder-mead.html#cb267-12"></a>)</span></code></pre></div>
<pre><code>                   p1           p2           p3 value fevals gevals niter convcode kkt1 kkt2 xtime
Nelder-Mead -1.570796 1.394018e-08 1.088215e-16    -1    861     NA    NA        0 TRUE TRUE 0.001</code></pre>
</div>
<div id="a-regression-model-1" class="section level3">
<h3>A Regression Model</h3>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="nelder-mead.html#cb269-1"></a><span class="kw">set.seed</span>(<span class="dv">8675309</span>)</span>
<span id="cb269-2"><a href="nelder-mead.html#cb269-2"></a></span>
<span id="cb269-3"><a href="nelder-mead.html#cb269-3"></a>N =<span class="st"> </span><span class="dv">500</span></span>
<span id="cb269-4"><a href="nelder-mead.html#cb269-4"></a>npreds =<span class="st"> </span><span class="dv">5</span></span>
<span id="cb269-5"><a href="nelder-mead.html#cb269-5"></a>X =<span class="st"> </span><span class="kw">cbind</span>(<span class="dv">1</span>, <span class="kw">matrix</span>(<span class="kw">rnorm</span>(N <span class="op">*</span><span class="st"> </span>npreds), <span class="dt">ncol =</span> npreds))</span>
<span id="cb269-6"><a href="nelder-mead.html#cb269-6"></a>beta =<span class="st"> </span><span class="kw">runif</span>(<span class="kw">ncol</span>(X), <span class="dv">-1</span>, <span class="dv">1</span>)</span>
<span id="cb269-7"><a href="nelder-mead.html#cb269-7"></a>y =<span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">nrow</span>(X))</span></code></pre></div>
<p>Least squares loss function to minimize.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="nelder-mead.html#cb270-1"></a>f =<span class="st"> </span><span class="cf">function</span>(b) {</span>
<span id="cb270-2"><a href="nelder-mead.html#cb270-2"></a>  <span class="kw">crossprod</span>(y <span class="op">-</span><span class="st"> </span>X <span class="op">%*%</span><span class="st"> </span>b)[,<span class="dv">1</span>]  <span class="co"># if using optimx need scalar</span></span>
<span id="cb270-3"><a href="nelder-mead.html#cb270-3"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="nelder-mead.html#cb271-1"></a>lm_par =<span class="st"> </span><span class="kw">lm.fit</span>(X, y)<span class="op">$</span>coef</span></code></pre></div>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="nelder-mead.html#cb272-1"></a>nm_par =<span class="st"> </span><span class="kw">nelder_mead2</span>(</span>
<span id="cb272-2"><a href="nelder-mead.html#cb272-2"></a>  f, </span>
<span id="cb272-3"><a href="nelder-mead.html#cb272-3"></a>  <span class="kw">runif</span>(<span class="kw">ncol</span>(X)),</span>
<span id="cb272-4"><a href="nelder-mead.html#cb272-4"></a>  <span class="dt">max_iter =</span> <span class="dv">2000</span>,</span>
<span id="cb272-5"><a href="nelder-mead.html#cb272-5"></a>  <span class="dt">no_improve_thr =</span> <span class="fl">1e-12</span></span>
<span id="cb272-6"><a href="nelder-mead.html#cb272-6"></a>)</span></code></pre></div>
</div>
<div id="comparison-17" class="section level3">
<h3>Comparison</h3>
<p>Compare to <code>optimx</code>.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="nelder-mead.html#cb273-1"></a>opt_par =<span class="st"> </span>optimx<span class="op">::</span><span class="kw">optimx</span>(</span>
<span id="cb273-2"><a href="nelder-mead.html#cb273-2"></a>  <span class="kw">runif</span>(<span class="kw">ncol</span>(X)),</span>
<span id="cb273-3"><a href="nelder-mead.html#cb273-3"></a>  <span class="dt">fn =</span> f,</span>
<span id="cb273-4"><a href="nelder-mead.html#cb273-4"></a>  <span class="dt">method   =</span> <span class="st">&#39;Nelder-Mead&#39;</span>,</span>
<span id="cb273-5"><a href="nelder-mead.html#cb273-5"></a>  <span class="dt">control  =</span> <span class="kw">list</span>(</span>
<span id="cb273-6"><a href="nelder-mead.html#cb273-6"></a>    <span class="dt">alpha  =</span> <span class="dv">1</span>,</span>
<span id="cb273-7"><a href="nelder-mead.html#cb273-7"></a>    <span class="dt">gamma  =</span> <span class="dv">2</span>,</span>
<span id="cb273-8"><a href="nelder-mead.html#cb273-8"></a>    <span class="dt">beta   =</span> <span class="fl">0.5</span>,</span>
<span id="cb273-9"><a href="nelder-mead.html#cb273-9"></a>    <span class="dt">maxit  =</span> <span class="dv">2000</span>,</span>
<span id="cb273-10"><a href="nelder-mead.html#cb273-10"></a>    <span class="dt">reltol =</span> <span class="fl">1e-12</span></span>
<span id="cb273-11"><a href="nelder-mead.html#cb273-11"></a>  )</span>
<span id="cb273-12"><a href="nelder-mead.html#cb273-12"></a>)[<span class="dv">1</span><span class="op">:</span>(npreds <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)]</span>
<span id="cb273-13"><a href="nelder-mead.html#cb273-13"></a></span>
<span id="cb273-14"><a href="nelder-mead.html#cb273-14"></a><span class="kw">rbind</span>(</span>
<span id="cb273-15"><a href="nelder-mead.html#cb273-15"></a>  <span class="dt">lm =</span> lm_par,</span>
<span id="cb273-16"><a href="nelder-mead.html#cb273-16"></a>  <span class="dt">nm =</span> nm_par,</span>
<span id="cb273-17"><a href="nelder-mead.html#cb273-17"></a>  <span class="dt">optimx =</span> opt_par,</span>
<span id="cb273-18"><a href="nelder-mead.html#cb273-18"></a>  <span class="dt">truth  =</span> beta</span>
<span id="cb273-19"><a href="nelder-mead.html#cb273-19"></a>)</span></code></pre></div>
<pre><code>               p1        p2         p3        p4        p5          p6
lm     -0.9621466 0.5943248 0.04864576 0.2757347 0.9752584 -0.07470287
nm     -0.9621510 0.5943270 0.04864183 0.2757265 0.9752524 -0.07470389
optimx -0.9621494 0.5943250 0.04864620 0.2757383 0.9752579 -0.07470054
truth  -0.9087584 0.6195267 0.07358131 0.3196977 0.9561050 -0.07977885</code></pre>
</div>
</div>
<div id="source-18" class="section level2">
<h2>Source</h2>
<p>Base R source code found at <a href="https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/nelder_mead.R" class="uri">https://github.com/m-clark/Miscellaneous-R-Code/blob/master/ModelFitting/nelder_mead.R</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="newton-irls.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="gradient-descent.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["twitter", "facebook", "linkedin", "google", "weibo", "instapaper"],
"google": false,
"instapper": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/m-clark/models-by-example/blob/master/nelder-mead.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"depth": 2,
"scroll_highlight": true
},
"df_print": "kable",
"highlight": "pygments",
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
